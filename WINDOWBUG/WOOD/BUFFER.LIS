
                               					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   1
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

0001          SUBROUTINE BU_NEW_NAMES(BU, NAME, FNAME)
0002          IMPLICIT INTEGER(A - P, R - Z)
0003          IMPLICIT LOGICAL(Q)
0004    C using real virtual memory allocation
0005          COMMON/MEMORY/ME_MEM(0:0)
0006    C dynamic memory
0007          INTEGER ME_MEM
0008    C string buffer
0009          BYTE ST_BUFFER(0:0)
0010    C text buffer
0011          BYTE TX_TEXT(0:0)
0012          EQUIVALENCE(ME_MEM, ST_BUFFER), (ME_MEM, TX_TEXT)
0013          COMMON/SESSION/SE_SAVE, SE_RESTORE, SE_MACROS, SE_BUFFERS, SE_CURR
0014         *ENT_WINDOW, SE_PAGES, SE_CURRENT_PAGE, SE_COMMAND_COUNT, SE_COUNT,
0015         * SE_DEFAULT_CASE, SE_INDENT, SE_SEARCH_STRING, SE_SEARCH_MASK, SE_
0016         *SEARCH_LENGTH, SE_ERROR_OCCURRED, SE_INTERRUPT_ENABLED, SE_IN_PROM
0017         *PT, SE_CROSS_LINES, SE_RECOVER, SE_WORD_DEFINITION( - 128:127, 0:1
0018         *0)
0019          LOGICAL*1SE_ERROR_OCCURRED, SE_INTERRUPT_ENABLED, SE_IN_PROMPT, SE
0020         *_CROSS_LINES, SE_RECOVER
0021          BYTE SE_WORD_DEFINITION
0022          BYTE NAME(1), FNAME(1), NUM(14), HO_CLOWER
0023          OLD = ME_MEM(2 + BU)
0024          ME_MEM(2 + BU) = 0
0025          CALL ST_DEALLOCATE(ME_MEM(3 + BU))
0026          IF (NAME(1) .NE. 0) THEN
0027            ST = ST_ALLOCATE(HO_LENGTH(NAME) + 1)
0028            CALL HO_SCOPY(NAME, 1, ST_BUFFER(ST), 1)
0029            I = ST
0030            DO WHILE (ST_BUFFER(I) .NE. 0)
0031              ST_BUFFER(I) = HO_CLOWER(ST_BUFFER(I))
0032    2300      I = I + 1
0033            END DO
0034          ELSE
0035            ST = BU_MAKE_NAME(FNAME)
0036          END IF
0037          IF (FNAME(1) .NE. 0) THEN
0038            ME_MEM(3 + BU) = ST_ALLOCATE(HO_LENGTH(FNAME) + 1)
0039            CALL HO_SCOPY(FNAME, 1, ST_BUFFER(ME_MEM(3 + BU)), 1)
0040          ELSE
0041            ME_MEM(3 + BU) = 0
0042          END IF
0043          SL = ST_LENGTH(ST)
0044          N = 2
0045          DO WHILE (BU_FIND_BY_NAME(ST_BUFFER(ST)) .NE. 0)
0046            NL = HO_ITOC(N, NUM(2), 12)
0047            NUM(1) = '<'
0048            NUM(2 + NL) = '>'
0049            NUM(3 + NL) = 0
0050            ST2 = ST_ALLOCATE(3 + NL + SL)
0051            CALL ST_SCOPY(ST, ST2)
0052            CALL HO_SCOPY(NUM, 1, ST_BUFFER(ST2 + SL), 1)
0053            CALL ST_DEALLOCATE(ST)
0054            ST = ST2
0055    2330    N = N + 1
0056          END DO
0057          ME_MEM(2 + BU) = ST

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   2
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

0058          IF (OLD .NE. 0) THEN
0059    C update old pointers
0060            PA = SE_PAGES
0061            DO WHILE (PA .NE. 0)
0062              WI = ME_MEM(2 + PA)
0063              DO WHILE (WI .NE. 0)
0064                IF (ME_MEM(6+WI) .EQ. OLD) THEN
0065                  ME_MEM(6 + WI) = ME_MEM(2 + BU)
0066    c              ME_MEM(7 + WI) = 1
0067                END IF
0068    2390        WI = ME_MEM(WI)
0069              END DO
0070    2360      PA = ME_MEM(PA)
0071            END DO
0072            CALL ST_DEALLOCATE(OLD)
0073          END IF
0074          CALL MP_SET_MAPPINGS(BU, 0)
0075          RETURN
0076          END

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   3
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

		.TITLE	BU_NEW_NAMES
		.IDENT	01

    0000	.PSECT	$PDATA
    0000	.LONG	^X00000000
    0004	.LONG	^X00000001
    0008	.LONG	^X0000000C

    0000	.PSECT	MEMORY
    0000  ME_MEM:

    0000	.PSECT	SESSION
    0000  SE_SAVE:
    0004  SE_RESTORE:
    0008  SE_MACROS:
    000C  SE_BUFFERS:
    0010  SE_CURRENT_WINDOW:
    0014  SE_PAGES:
    0018  SE_CURRENT_PAGE:
    001C  SE_COMMAND_COUNT:
    0020  SE_COUNT:
    0024  SE_DEFAULT_CASE:
    0028  SE_INDENT:
    002C  SE_SEARCH_STRING:
    0030  SE_SEARCH_MASK:
    0034  SE_SEARCH_LENGTH:
    0038  SE_ERROR_OCCURRED:
    0039  SE_INTERRUPT_ENABLED:
    003A  SE_IN_PROMPT:
    003B  SE_CROSS_LINES:
    003C  SE_RECOVER:
    003D  SE_WORD_DEFINITION:

    0000	.PSECT	MEMORY
    0000  TX_TEXT:
    0000  ST_BUFFER:

    0034	.PSECT	$LOCAL
    0034	.LONG	^X04020001
    0038	.LONG	^X00000000
    003C	.LONG	^X01200000,^X00000001
    0044	.LONG	^X00000000
    0048	.LONG	^X04020001
    004C	.LONG	^X00000000
    0050	.LONG	^X01200000,^X00000001
    0058	.LONG	^X00000000
    005C	.LONG	^X00000001
    0060	.LONG	^X00000000
    0064	.LONG	^X00000001
    0068	.LONG	^X00000000
    006C	.LONG	^X00000004
    0070	.LONG	^X00000000
    0074	.ADDR	$PDATA+^X4
    0078	.LONG	^X00000000
    007C	.ADDR	$PDATA+^X4
    0080	.LONG	^X00000001
    0084	.ADDR	ST

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   4
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

    0088	.LONG	^X00000003
    008C	.ADDR	N
    0090	.ADDR	NUM+1
    0094	.ADDR	$PDATA+^X8
    0098	.LONG	^X00000002
    009C	.ADDR	ST
    00A0	.ADDR	ST2
    00A4	.LONG	^X00000004
    00A8	.ADDR	NUM
    00AC	.ADDR	$PDATA+^X4
    00B0	.LONG	^X00000000
    00B4	.ADDR	$PDATA+^X4
    00B8	.LONG	^X00000001
    00BC	.ADDR	OLD
    00C0	.LONG	^X00000002
    00C4	.LONG	^X00000000
    00C8	.ADDR	$PDATA

    0000	.PSECT	$CODE
									    ; 0001
    0000  BU_NEW_NAMES::
    0000	.WORD	^M<R11>
    0002	MOVAL	$LOCAL+^X10, R11
    0009	MOVL	NAME(AP), $LOCAL+^X38(R11)
    000E	SUBL3	#1, NAME(AP), $LOCAL+^X44(R11)
    0014	MOVL	FNAME(AP), $LOCAL+^X4C(R11)
    0019	SUBL3	#1, FNAME(AP), $LOCAL+^X58(R11)
									    ; 0023
    001F	MOVL	@BU(AP), R0
    0023	MOVL	ME_MEM+8[R0], OLD(R11)
									    ; 0024
    002B	MOVL	@BU(AP), R0
    002F	CLRL	ME_MEM+8[R0]
									    ; 0025
    0036	MOVL	@BU(AP), R0
    003A	MOVAL	ME_MEM+12[R0], $LOCAL+^X60(R11)
    0043	CALLG	$LOCAL+^X5C(R11), ST_DEALLOCATE
									    ; 0026
    004B	MOVL	#1, R0
    004E	TSTB	@$LOCAL+^X44(R11)[R0]
    0052	BEQL	L$3
									    ; 0027
    0054	MOVAB	@NAME(AP), $LOCAL+^X60(R11)
    0059	CALLG	$LOCAL+^X5C(R11), HO_LENGTH
    0061	ADDL3	#1, R0, -(SP)
    0065	MOVL	SP, $LOCAL+^X68(R11)
    0069	CALLG	$LOCAL+^X64(R11), ST_ALLOCATE
    0071	ADDL2	#4, SP
    0074	MOVL	R0, ST(R11)
									    ; 0028
    0078	MOVAB	@NAME(AP), $LOCAL+^X70(R11)
    007D	MOVL	ST(R11), R0
    0081	MOVAB	ST_BUFFER[R0], $LOCAL+^X78(R11)
    008A	CALLG	$LOCAL+^X6C(R11), HO_SCOPY
									    ; 0029
    0092	MOVL	ST(R11), I(R11)
    0097  L$1:

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   5
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

									    ; 0030
    0097	MOVL	I(R11), R0
    009B	TSTB	ST_BUFFER[R0]
    00A2	BEQL	L$2
									    ; 0031
    00A4	MOVL	I(R11), R0
    00A8	MOVAB	ST_BUFFER[R0], $LOCAL+^X68(R11)
    00B1	CALLG	$LOCAL+^X64(R11), HO_CLOWER
    00B9	MOVL	I(R11), R1
    00BD	MOVB	R0, ST_BUFFER[R1]
    00C5  .2300:
									    ; 0032
    00C5	INCL	I(R11)
									    ; 0033
    00C8	BRB	L$1
    00CA  L$2:
    00CA	BRB	L$4
    00CC  L$3:
									    ; 0035
    00CC	MOVAB	@FNAME(AP), $LOCAL+^X68(R11)
    00D1	CALLG	$LOCAL+^X64(R11), BU_MAKE_NAME
    00D9	MOVL	R0, ST(R11)
    00DD  L$4:
									    ; 0037
    00DD	MOVL	#1, R0
    00E0	TSTB	@$LOCAL+^X58(R11)[R0]
    00E4	BEQL	L$5
									    ; 0038
    00E6	MOVAB	@FNAME(AP), $LOCAL+^X68(R11)
    00EB	CALLG	$LOCAL+^X64(R11), HO_LENGTH
    00F3	ADDL3	#1, R0, -(SP)
    00F7	MOVL	SP, $LOCAL+^X60(R11)
    00FB	CALLG	$LOCAL+^X5C(R11), ST_ALLOCATE
    0103	ADDL2	#4, SP
    0106	MOVL	@BU(AP), R1
    010A	MOVL	R0, ME_MEM+12[R1]
									    ; 0039
    0112	MOVAB	@FNAME(AP), $LOCAL+^X70(R11)
    0117	MOVL	@BU(AP), R1
    011B	MOVL	ME_MEM+12[R1], R0
    0123	MOVAB	ST_BUFFER[R0], $LOCAL+^X78(R11)
    012C	CALLG	$LOCAL+^X6C(R11), HO_SCOPY
    0134	BRB	L$6
    0136  L$5:
									    ; 0041
    0136	MOVL	@BU(AP), R0
    013A	CLRL	ME_MEM+12[R0]
    0141  L$6:
									    ; 0043
    0141	CALLG	$LOCAL+^X80(R11), ST_LENGTH
    0149	MOVL	R0, SL(R11)
									    ; 0044
    014D	MOVL	#2, N(R11)
    0151  L$7:
									    ; 0045
    0151	MOVL	ST(R11), R0
    0155	MOVAB	ST_BUFFER[R0], $LOCAL+^X68(R11)

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   6
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

    015E	CALLG	$LOCAL+^X64(R11), BU_FIND_BY_NAME
    0166	TSTL	R0
    0168	BEQL	L$8
									    ; 0046
    016A	CALLG	$LOCAL+^X88(R11), HO_ITOC
    0172	MOVL	R0, NL(R11)
									    ; 0047
    0176	MOVB	#60, NUM(R11)
									    ; 0048
    017A	MOVL	NL(R11), R0
    017E	MOVB	#62, NUM+1(R11)[R0]
									    ; 0049
    0183	MOVL	NL(R11), R0
    0187	CLRB	NUM+2(R11)[R0]
									    ; 0050
    018B	ADDL3	#3, NL(R11), R0
    0190	ADDL3	SL(R11), R0, -(SP)
    0195	MOVL	SP, $LOCAL+^X68(R11)
    0199	CALLG	$LOCAL+^X64(R11), ST_ALLOCATE
    01A1	ADDL2	#4, SP
    01A4	MOVL	R0, ST2(R11)
									    ; 0051
    01A8	CALLG	$LOCAL+^X98(R11), ST_SCOPY
									    ; 0052
    01B1	ADDL3	SL(R11), ST2(R11), R0
    01B7	MOVAB	ST_BUFFER[R0], $LOCAL+^XB0(R11)
    01C1	CALLG	$LOCAL+^XA4(R11), HO_SCOPY
									    ; 0053
    01CA	CALLG	$LOCAL+^X80(R11), ST_DEALLOCATE
									    ; 0054
    01D2	MOVL	ST2(R11), ST(R11)
    01D7  .2330:
									    ; 0055
    01D7	INCL	N(R11)
									    ; 0056
    01DA	BRW	L$7
    01DD  L$8:
									    ; 0057
    01DD	MOVL	@BU(AP), R0
    01E1	MOVL	ST(R11), ME_MEM+8[R0]
									    ; 0058
    01EA	TSTL	OLD(R11)
    01EC	BEQL	L$13
									    ; 0060
    01EE	MOVL	SE_PAGES, PA(R11)
    01F6  L$9:
									    ; 0061
    01F6	TSTL	PA(R11)
    01F9	BEQL	L$12
									    ; 0062
    01FB	MOVL	PA(R11), R0
    01FF	MOVL	ME_MEM+8[R0], WI(R11)
    0208  L$10:
									    ; 0063
    0208	TSTL	WI(R11)
    020B	BEQL	.2360
									    ; 0064

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   7
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

    020D	MOVL	WI(R11), R0
    0211	CMPL	ME_MEM+24[R0], OLD(R11)
    0219	BNEQ	L$11
									    ; 0065
    021B	MOVL	WI(R11), R1
    021F	MOVL	@BU(AP), R0
    0223	MOVL	ME_MEM+8[R0], ME_MEM+24[R1]
    0230  L$11:
									    ; 0067
    0230  .2390:
									    ; 0068
    0230	MOVL	WI(R11), R1
    0234	MOVL	ME_MEM[R1], WI(R11)
									    ; 0069
    023D	BRB	L$10
									    ; 0070
    023F  .2360:
    023F	MOVL	PA(R11), R1
    0243	MOVL	ME_MEM[R1], PA(R11)
									    ; 0071
    024C	BRB	L$9
    024E  L$12:
									    ; 0072
    024E	CALLG	$LOCAL+^XB8(R11), ST_DEALLOCATE
    0257  L$13:
									    ; 0074
    0257	MOVAL	@BU(AP), $LOCAL+^XC4(R11)
    025D	CALLG	$LOCAL+^XC0(R11), MP_SET_MAPPINGS
									    ; 0075
    0266	RET	
		.END

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   8
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

PROGRAM SECTIONS

    Name				 Bytes   Attributes

  0 $CODE                                  615   PIC CON REL LCL   SHR   EXE   RD NOWRT LONG
  1 $PDATA                                  12   PIC CON REL LCL   SHR NOEXE   RD NOWRT LONG
  2 $LOCAL                                 204   PIC CON REL LCL NOSHR NOEXE   RD   WRT LONG
  3 MEMORY                                   4   PIC OVR REL GBL   SHR NOEXE   RD   WRT LONG
  4 SESSION                               2877   PIC OVR REL GBL   SHR NOEXE   RD   WRT LONG

    Total Space Allocated                 3712


ENTRY POINTS

    Address  Type  Name          

  0-00000000       BU_NEW_NAMES  


VARIABLES

    Address  Type  Name                                               Address  Type  Name                            

 AP-00000004@ I*4  BU                                               2-00000018  I*4  I                               
  2-00000020  I*4  N                                                2-00000024  I*4  NL                              
  2-00000010  I*4  OLD                                              2-0000002C  I*4  PA                              
  4-0000000C  I*4  SE_BUFFERS                                       4-0000001C  I*4  SE_COMMAND_COUNT                
  4-00000020  I*4  SE_COUNT                                         4-0000003B  L*1  SE_CROSS_LINES                  
  4-00000018  I*4  SE_CURRENT_PAGE                                  4-00000010  I*4  SE_CURRENT_WINDOW               
  4-00000024  I*4  SE_DEFAULT_CASE                                  4-00000038  L*1  SE_ERROR_OCCURRED               
  4-00000028  I*4  SE_INDENT                                        4-00000039  L*1  SE_INTERRUPT_ENABLED            
  4-0000003A  L*1  SE_IN_PROMPT                                     4-00000008  I*4  SE_MACROS                       
  4-00000014  I*4  SE_PAGES                                         4-0000003C  L*1  SE_RECOVER                      
  4-00000004  I*4  SE_RESTORE                                       4-00000000  I*4  SE_SAVE                         
  4-00000034  I*4  SE_SEARCH_LENGTH                                 4-00000030  I*4  SE_SEARCH_MASK                  
  4-0000002C  I*4  SE_SEARCH_STRING                                 2-0000001C  I*4  SL                              
  2-00000014  I*4  ST                                               2-00000028  I*4  ST2                             
  2-00000030  I*4  WI                                             


ARRAYS

    Address  Type  Name                                  Bytes  Dimensions

 AP-0000000C@ L*1  FNAME                                     1  (1)
  3-00000000  I*4  ME_MEM                                    4  (0:0)
 AP-00000008@ L*1  NAME                                      1  (1)
  2-00000000  L*1  NUM                                      14  (14)
  4-0000003D  L*1  SE_WORD_DEFINITION                     2816  (-128:127, 0:10)
  3-00000000  L*1  ST_BUFFER                                 1  (0:0)
  3-00000000  L*1  TX_TEXT                                   1  (0:0)

BU_NEW_NAMES                   					 7-Dec-1986 16:31:10	VAX FORTRAN V4.5-219                Page   9
								 7-Dec-1986 16:01:03	COM$8:[WOOD.WINDOW.WOOD]BUFFER.FOR;2        

LABELS

    Address   Label       Address   Label       Address   Label       Address   Label   

  0-000000C5  2300      0-000001D7  2330      0-0000023F  2360      0-00000230  2390    


FUNCTIONS AND SUBROUTINES REFERENCED

  Type  Name                              Type  Name                              Type  Name                            

   I*4  BU_FIND_BY_NAME                    I*4  BU_MAKE_NAME                       L*1  HO_CLOWER                       
   I*4  HO_ITOC                            I*4  HO_LENGTH                               HO_SCOPY                        
        MP_SET_MAPPINGS                    I*4  ST_ALLOCATE                             ST_DEALLOCATE                   
   I*4  ST_LENGTH                               ST_SCOPY                        


COMMAND QUALIFIERS

  FORTRAN/MACH/NOCH/NODEB/NOOPT/LIST=BUFFER/OBJECT=BUFFER BUFFER

  /CHECK=(NOBOUNDS,NOOVERFLOW,NOUNDERFLOW)
  /DEBUG=(NOSYMBOLS,NOTRACEBACK)
  /STANDARD=(NOSYNTAX,NOSOURCE_FORM)
  /SHOW=(NOPREPROCESSOR,NOINCLUDE,MAP,NODICTIONARY,SINGLE)
  /WARNINGS=(GENERAL,NODECLARATIONS,NOULTRIX)
  /CONTINUATIONS=19  /NOCROSS_REFERENCE  /NOD_LINES  /NOEXTEND_SOURCE  /F77
  /NOG_FLOATING  /I4  /MACHINE_CODE  /NOOPTIMIZE


COMPILATION STATISTICS

  Run Time:           0.48 seconds
  Elapsed Time:       0.96 seconds
  Page Faults:        499
  Dynamic Memory:     371 pages
