
BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 1
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)



    1        	/*	Zilch Screen Editor,
    2        	 *	Copyright (c) 1982,1983,1984,1986,1987 William P. Wood, Jr. */
    3        	
    4        	#include "symbols.h"
  400        	#include "memory.cmn"
  416        	#include "session.cmn"
  454        	
  455        	int q_switch_to_buffer(register bufferp bu, const char *na)
  456        	{
                                          0024	q_switch_to_buffer:
                                    01FC  0024		.entry	q_switch_to_buffer,^m<r2,r3,r4,r5,r6,r7,r8>
                              5E 04 C2    0026		subl2	#4,sp
                     58 00000000 EF 9E    0029		movab	SE_CURRENT_WINDOW,r8
                           52 04 AC D0    0030		movl	4(ap),r2

  457    1   	  windowp wicur;
  458    1   	  register windowp wi, wi2;
  459    1   	
  460    1   	  if (bu == null)
                                 0D 12    0034		bneq	sym.1

  461    1   	    bu = bu_find_by_name(na);
                              08 AC DD    0036		pushl	8(ap)
                    00000000* EF 01 FB    0039		calls	#1,BU_FIND_BY_NAME
                              52 50 D0    0040		movl	r0,r2

  462    1   	  if (bu == null)
                                          0043	sym.1:
                                 52 D5    0043		tstl	r2
                                 13 12    0045		bneq	sym.2

  463    1   	    bu = bu_new(na,"");
                        00000000 EF DF    0047		pushal	$CHAR_STRING_CONSTANTS
                              08 AC DD    004D		pushl	8(ap)
                    00000000* EF 02 FB    0050		calls	#2,BU_NEW
                              52 50 D0    0057		movl	r0,r2

  464    1   	  wi_switch_to_buffer(se_current_window, bu);
                                          005A	sym.2:
                                 52 DD    005A		pushl	r2
                                 68 DD    005C		pushl	(r8)
                    00000000* EF 02 FB    005E		calls	#2,WI_SWITCH_TO_BUFFER

  465    1   	  wi_map(se_windows,wi) /* try to find another window onto bu to set dot from */
                  53 00000000 EF 02 78    0065		ashl	#2,SE_CURRENT_PAGE,r3
                              53 02 C0    006D		addl2	#2,r3
                              51 63 D0    0070		movl	(r3),r1
                                 73 13    0073		beql	sym.7
                                 50 D5    0075		tstl	r0
                                    01    0077		nop	
                                          0078	sym.3:

  466    1   	    if (wi != se_current_window && wi_parent_buffer(wi) == bu_parent(bu)) {
                              68 51 D1    0078		cmpl	r1,(r8)
                                 5F 13    007B		beql	sym.6

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 2
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                           62 00 B1 D1    007D		cmpl	@0(r1),(r2)
                                 59 12    0081		bneq	sym.6

  467    2   	      wicur = wi_parent(se_current_window);
                           53 68 02 78    0083		ashl	#2,(r8),r3
                              53 0B C0    0087		addl2	#11,r3
                              57 63 D0    008A		movl	(r3),r7

  468    2   	      wi_map_sub_windows(wi, wi2) {
                           53 51 02 78    008D		ashl	#2,r1,r3
                              53 0B C0    0091		addl2	#11,r3
                              50 63 D0    0094		movl	(r3),r0
                                 4F 13    0097		beql	sym.7
                                 50 D5    0099		tstl	r0
                                    01    009B		nop	
                                          009C	sym.4:

  469    3   		wi_dot(wicur) = wi_dot(wi2);
                           55 57 02 78    009C		ashl	#2,r7,r5
                           54 55 01 C1    00A0		addl3	#1,r5,r4
                           56 50 02 78    00A4		ashl	#2,r0,r6
                           53 56 01 C1    00A8		addl3	#1,r6,r3
                              64 63 D0    00AC		movl	(r3),(r4)

  470    3   		wi_set_bow(wicur,wi_bow(wi2));
                           54 55 02 C1    00AF		addl3	#2,r5,r4
                           53 56 02 C1    00B3		addl3	#2,r6,r3
                              64 63 D0    00B7		movl	(r3),(r4)
                           53 55 06 C1    00BA		addl3	#6,r5,r3
                              63 01 D0    00BE		movl	#1,(r3)

  471    3   		if (wi2 == wi)
                              51 50 D1    00C1		cmpl	r0,r1
                                 03 12    00C4		bneq	sym.5

  472    3   		  se_current_window = wicur;
                              68 57 D0    00C6		movl	r7,(r8)

  473    3   		wicur = wi_sub_windows(wicur);
                                          00C9	sym.5:
                              55 0C C0    00C9		addl2	#12,r5
                              57 65 D0    00CC		movl	(r5),r7

  474    3   		}
                              56 0C C0    00CF		addl2	#12,r6
                              50 66 D0    00D2		movl	(r6),r0
                                 C5 12    00D5		bneq	sym.4

  475    2   	      break;
                                 0F 11    00D7		brb	sym.7
                                 50 D5    00D9		tstl	r0
                                    01    00DB		nop	

  476    2   	      }
  477    1   	  return true;
                                          00DC	sym.6:
                           53 51 02 78    00DC		ashl	#2,r1,r3

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 3
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                              53 09 C0    00E0		addl2	#9,r3
                              51 63 D0    00E3		movl	(r3),r1
                                 90 12    00E6		bneq	sym.3
                                          00E8	sym.7:
                              50 01 D0    00E8		movl	#1,r0
                                    04    00EB		ret	

  478    1   	}
  479        	
  480        	int q_pop_to_buffer(bufferp bu, const char *na)
  481        	{
                                          00EC	q_pop_to_buffer:
                                    0004  00EC		.entry	q_pop_to_buffer,^m<r2>
                              5E 04 C2    00EE		subl2	#4,sp
                     52 00000000 EF 9E    00F1		movab	$CHAR_STRING_CONSTANTS,r2

  482    1   	  if (q_pop_up_window())
                    00000000* EF 00 FB    00F8		calls	#0,Q_POP_UP_WINDOW
                                 50 D5    00FF		tstl	r0
                                 0E 13    0101		beql	sym.8

  483    1   	    return q_switch_to_buffer(bu, na);
                              08 AC DD    0103		pushl	8(ap)
                              04 AC DD    0106		pushl	4(ap)
                    00000000* EF 02 FB    0109		calls	#2,Q_SWITCH_TO_BUFFER
                                    04    0110		ret	

  484    1   	  ms_error("Can't make a new window!");
                                          0111	sym.8:
                              01 A2 DF    0111		pushal	1(r2)
                    00000000* EF 01 FB    0114		calls	#1,MS_ERROR

  485    1   	  return false;
                                 50 D4    011B		clrl	r0
                                    04    011D		ret	

  486    1   	}
  487        	
  488        	int q_visit_file(const char *na, int switch_buffer, int nf)
  489        	{
                                          011E	q_visit_file:
                                    001C  011E		.entry	q_visit_file,^m<r2,r3,r4>
                              5E 04 C2    0120		subl2	#4,sp
                     53 00000000 EF 9E    0123		movab	$CHAR_STRING_CONSTANTS,r3
                     54 00000000 EF 9E    012A		movab	MEMORY,r4

  490    1   	  register bufferp bu;
  491    1   	
  492    1   	  bu = bu_find_by_file_name(na);
                              04 AC DD    0131		pushl	4(ap)
                    00000000* EF 01 FB    0134		calls	#1,BU_FIND_BY_FILE_NAME
                              52 50 D0    013B		movl	r0,r2

  493    1   	  if (bu == null) {
                                 21 12    013E		bneq	sym.9

  494    2   	    bu = bu_new("",na);

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 4
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                              04 AC DD    0140		pushl	4(ap)
                              1A A3 DF    0143		pushal	26(r3)
                    00000000* EF 02 FB    0146		calls	#2,BU_NEW
                              52 50 D0    014D		movl	r0,r2

  495    2   	    if (se_recover)
                        00000000 EF 95    0150		tstb	SE_RECOVER
                                 09 13    0156		beql	sym.9

  496    2   	      q_ch_recover(bu);
                                 52 DD    0158		pushl	r2
                    00000000* EF 01 FB    015A		calls	#1,Q_CH_RECOVER

  497    2   	    }
                                          0161	sym.9:

  498    1   	  if (switch_buffer)
                              08 AC D5    0161		tstl	8(ap)
                                 18 13    0164		beql	sym.10

  499    1   	    return q_switch_to_buffer(bu, st_buffer(bu_name(bu)));
                              51 64 DE    0166		moval	(r4),r1
                           50 62 02 78    0169		ashl	#2,(r2),r0
                              50 02 C0    016D		addl2	#2,r0
                           7E 51 60 C1    0170		addl3	(r0),r1,-(sp)
                                 52 DD    0174		pushl	r2
                    00000000* EF 02 FB    0176		calls	#2,Q_SWITCH_TO_BUFFER
                                    04    017D		ret	

  500    1   	  else if (nf == 1)
                                          017E	sym.10:
                           01 0C AC D1    017E		cmpl	12(ap),#1
                                 23 12    0182		bneq	sym.11

  501    1   	    if (q_pop_up_window())
                    00000000* EF 00 FB    0184		calls	#0,Q_POP_UP_WINDOW
                                 50 D5    018B		tstl	r0
                                 18 13    018D		beql	sym.11

  502    1   	      return q_switch_to_buffer(bu, st_buffer(bu_name(bu)));
                              51 64 DE    018F		moval	(r4),r1
                           50 62 02 78    0192		ashl	#2,(r2),r0
                              50 02 C0    0196		addl2	#2,r0
                           7E 51 60 C1    0199		addl3	(r0),r1,-(sp)
                                 52 DD    019D		pushl	r2
                    00000000* EF 02 FB    019F		calls	#2,Q_SWITCH_TO_BUFFER
                                    04    01A6		ret	

  503    1   	  pa_generate(pa_number(se_current_page));
                                          01A7	sym.11:
                  50 00000000 EF 02 78    01A7		ashl	#2,SE_CURRENT_PAGE,r0
                                 50 D6    01AF		incl	r0
                                 60 DD    01B1		pushl	(r0)
                    00000000* EF 01 FB    01B3		calls	#1,PA_GENERATE

  504    1   	  if (q_split_current_window())
                    00000000* EF 00 FB    01BA		calls	#0,Q_SPLIT_CURRENT_WINDOW

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 5
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                 50 D5    01C1		tstl	r0
                                 18 13    01C3		beql	sym.12

  505    1   	    return q_switch_to_buffer(bu, st_buffer(bu_name(bu)));
                              51 64 DE    01C5		moval	(r4),r1
                           50 62 02 78    01C8		ashl	#2,(r2),r0
                              50 02 C0    01CC		addl2	#2,r0
                           7E 51 60 C1    01CF		addl3	(r0),r1,-(sp)
                                 52 DD    01D3		pushl	r2
                    00000000* EF 02 FB    01D5		calls	#2,Q_SWITCH_TO_BUFFER
                                    04    01DC		ret	

  506    1   	  return false;
                                          01DD	sym.12:
                                 50 D4    01DD		clrl	r0
                                    04    01DF		ret	

  507    1   	}
  508        	
  509        	void multi_visit_file(const char *na, int switch_buffer, int clear_context)
  510        	{
                                          01E0	multi_visit_file:
                                    0FFC  01E0		.entry	multi_visit_file,^m<r2,r3,r4,r5,r6,r7,r8,r9,r10,r11>
                              5E 14 C2    01E2		subl2	#20,sp
                     59 00000000 EF 9E    01E5		movab	MEMORY,r9

  511    1   	  register stringp st, st1, fi;
  512    1   	  pagep pa;
  513    1   	  int totfiles, nfile, n;
  514    1   	
  515    1   	  fi = st_allocate(FILENAMESIZE);
                         7E 0100 8F 3C    01EC		movzwl	#256,-(sp)
                    52 00000000* EF 9E    01F1		movab	ST_ALLOCATE,r2
                              62 01 FB    01F8		calls	#1,(r2)
                              54 50 D0    01FB		movl	r0,r4

  516    1   	  st = st_allocate(max(MAX_COMMAND,MAX_PROMPT));
                         7E 0201 8F 3C    01FE		movzwl	#513,-(sp)
                              62 01 FB    0203		calls	#1,(r2)
                              53 50 D0    0206		movl	r0,r3

  517    1   	  st1 = st_allocate(max(MAX_COMMAND,MAX_PROMPT));
                         7E 0201 8F 3C    0209		movzwl	#513,-(sp)
                              62 01 FB    020E		calls	#1,(r2)
                              52 50 D0    0211		movl	r0,r2

  518    1   	  pa = se_current_page;
                  04 AE 00000000 EF D0    0214		movl	SE_CURRENT_PAGE,4(sp)

  519    1   	  totfiles = 0;
                                 57 D4    021C		clrl	r7

  520    1   	  while (q_co_parse(na, st_buffer(st1), false)) {
                                 00 DD    021E		pushl	#0
                              55 69 DE    0220		moval	(r9),r5
                           7E 55 52 C1    0223		addl3	r2,r5,-(sp)
                        08 AE 04 AC DE    0227		moval	4(ap),8(sp)

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 6
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                              08 BE DD    022C		pushl	@8(sp)
                    00000000* EF 03 FB    022F		calls	#3,Q_CO_PARSE
                                 50 D5    0236		tstl	r0
                                 03 12    0238		bneq	gen.1
                               0103 31    023A		brw	sym.22
                                          023D	gen.1:
                 0C AE 00000000* EF 9E    023D		movab	Q_CO_PARSE,12(sp)
                    5A 00000000* EF 9E    0245		movab	Q_FI_FIND_FILE,r10
                    5B 00000000* EF 9E    024C		movab	Q_VISIT_FILE,r11
               0008 CE 00000000* EF 9E    0253		movab	MS_ERROR,8(sp)
                                          025C	sym.13:

  521    2   	    nfile = 0;
                                 56 D4    025C		clrl	r6

  522    2   	    while (q_co_parse(st_buffer(st1), st_buffer(st), true)) {
                                 01 DD    025E		pushl	#1
                              58 69 DE    0260		moval	(r9),r8
                           7E 58 53 C1    0263		addl3	r3,r8,-(sp)
                           7E 58 52 C1    0267		addl3	r2,r8,-(sp)
                           18 BE 03 FB    026B		calls	#3,@24(sp)
                                 50 D5    026F		tstl	r0
                                 03 12    0271		bneq	gen.2
                               008C 31    0273		brw	sym.20
                                          0276	gen.2:
                                 50 D5    0276		tstl	r0
                                          0278	sym.14:

  523    3   	      n = 0;
  524    3   	      if (q_fi_find_file(FIND_UNIT,st_buffer(st),st_buffer(fi),n,true,
  525    3   					totfiles == 0 && clear_context)) {
                                 58 94    0278		clrb	r8
                                 57 D5    027A		tstl	r7
                                 07 12    027C		bneq	sym.15
                              0C AC D5    027E		tstl	12(ap)
                                 02 13    0281		beql	sym.15
                                 58 96    0283		incb	r8
                                          0285	sym.15:
                              7E 58 98    0285		cvtbl	r8,-(sp)
                                 01 DD    0288		pushl	#1
                                 00 DD    028A		pushl	#0
                              55 69 DE    028C		moval	(r9),r5
                           7E 55 54 C1    028F		addl3	r4,r5,-(sp)
                           7E 55 53 C1    0293		addl3	r3,r5,-(sp)
                                 03 DD    0297		pushl	#3
                              6A 06 FB    0299		calls	#6,(r10)
                                 50 D5    029C		tstl	r0
                                 40 13    029E		beql	sym.18

  526    4   		do {
                                          02A0	sym.16:

  527    5   		  nfile = nfile + 1;
                                 56 D6    02A0		incl	r6

  528    5   		  totfiles = totfiles + 1;
                                 57 D6    02A2		incl	r7

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 7
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  529    5   		  q_visit_file(st_buffer(fi), switch_buffer && totfiles == 1, nfile);
                                 56 DD    02A4		pushl	r6
                                 55 94    02A6		clrb	r5
                              08 AC D5    02A8		tstl	8(ap)
                                 07 13    02AB		beql	sym.17
                              01 57 D1    02AD		cmpl	r7,#1
                                 02 12    02B0		bneq	sym.17
                                 55 96    02B2		incb	r5
                                          02B4	sym.17:
                              7E 55 98    02B4		cvtbl	r5,-(sp)
                              50 69 DE    02B7		moval	(r9),r0
                           7E 50 54 C1    02BA		addl3	r4,r0,-(sp)
                              6B 03 FB    02BE		calls	#3,(r11)

  530    5   		  } while (q_fi_find_file(FIND_UNIT, st_buffer(st), st_buffer(fi), n,
  531    4   						true, false));
                                 00 DD    02C1		pushl	#0
                                 01 DD    02C3		pushl	#1
                                 00 DD    02C5		pushl	#0
                              51 69 DE    02C7		moval	(r9),r1
                           7E 51 54 C1    02CA		addl3	r4,r1,-(sp)
                           7E 51 53 C1    02CE		addl3	r3,r1,-(sp)
                                 03 DD    02D2		pushl	#3
                              6A 06 FB    02D4		calls	#6,(r10)
                                 50 D5    02D7		tstl	r0
                                 C5 12    02D9		bneq	sym.16

  532    4   		}
  533    3   	      else
                                 0D 11    02DB		brb	sym.19
                                 50 D5    02DD		tstl	r0
                                    01    02DF		nop	
                                          02E0	sym.18:

  534    3   		ms_error("Bad file name encountered!");
                        0000001B EF DF    02E0		pushal	$CHAR_STRING_CONSTANTS+27
                           0C BE 01 FB    02E6		calls	#1,@12(sp)
                                          02EA	sym.19:

  535    3   	      }
                                 01 DD    02EA		pushl	#1
                              55 69 DE    02EC		moval	(r9),r5
                           7E 55 53 C1    02EF		addl3	r3,r5,-(sp)
                           7E 55 52 C1    02F3		addl3	r2,r5,-(sp)
                           18 BE 03 FB    02F7		calls	#3,@24(sp)
                                 50 D5    02FB		tstl	r0
                                 03 13    02FD		beql	gen.3
                               FF76 31    02FF		brw	sym.14
                                          0302	gen.3:
                                          0302	sym.20:

  536    2   	    if (se_current_page != pa) {
                  04 AE 00000000 EF D1    0302		cmpl	SE_CURRENT_PAGE,4(sp)
                                 1D 13    030A		beql	sym.21

  537    3   	      ms_message("Some files windowed on succeeding pages.");
                        00000036 EF DF    030C		pushal	$CHAR_STRING_CONSTANTS+54

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 8
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                    00000000* EF 01 FB    0312		calls	#1,MS_MESSAGE

  538    3   	      pa_switch(pa_number(pa));
                        55 04 AE 02 78    0319		ashl	#2,4(sp),r5
                                 55 D6    031E		incl	r5
                                 65 DD    0320		pushl	(r5)
                    00000000* EF 01 FB    0322		calls	#1,PA_SWITCH

  539    3   	      }
  540    2   	    }
                                          0329	sym.21:
                                 00 DD    0329		pushl	#0
                              55 69 DE    032B		moval	(r9),r5
                           7E 55 52 C1    032E		addl3	r2,r5,-(sp)
                              08 BE DD    0332		pushl	@8(sp)
                           18 BE 03 FB    0335		calls	#3,@24(sp)
                                 50 D5    0339		tstl	r0
                                 03 13    033B		beql	gen.4
                               FF1C 31    033D		brw	sym.13
                                          0340	gen.4:
                                          0340	sym.22:

  541    1   	  st_deallocate(fi);
                                 54 DD    0340		pushl	r4
                    55 00000000* EF 9E    0342		movab	ST_DEALLOCATE,r5
                              65 01 FB    0349		calls	#1,(r5)

  542    1   	  st_deallocate(st);
                                 53 DD    034C		pushl	r3
                              65 01 FB    034E		calls	#1,(r5)

  543    1   	  st_deallocate(st1);
                                 52 DD    0351		pushl	r2
                              65 01 FB    0353		calls	#1,(r5)

  544    1   	}
                                    04    0356		ret	

  545        	
  546        	void bu_ready(register bufferp bu)
  547        	{
                                          0357	bu_ready:
                                    001C  0357		.entry	bu_ready,^m<r2,r3,r4>
                              5E 04 C2    0359		subl2	#4,sp
                     54 00000000 EF 9E    035C		movab	$CHAR_STRING_CONSTANTS,r4
                           53 04 AC D0    0363		movl	4(ap),r3

  548    1   	  register bufferp bu2;
  549    1   	
  550    1   	  if (bu_modified(bu) == 2) {
                           52 63 02 78    0367		ashl	#2,(r3),r2
                              52 04 C0    036B		addl2	#4,r2
                              02 62 D1    036E		cmpl	(r2),#2
                                 3F 12    0371		bneq	sym.24

  551    2   	    if (! q_mp_read_file(bu,st_buffer(bu_file_name(bu)),0,true))
                                 01 DD    0373		pushl	#1

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 9
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                 00 DD    0375		pushl	#0
                     50 00000000 EF DE    0377		moval	MEMORY,r0
                           52 63 02 78    037E		ashl	#2,(r3),r2
                              52 03 C0    0382		addl2	#3,r2
                           7E 50 62 C1    0385		addl3	(r2),r0,-(sp)
                                 53 DD    0389		pushl	r3
                    00000000* EF 04 FB    038B		calls	#4,Q_MP_READ_FILE
                                 50 D5    0392		tstl	r0
                                 13 12    0394		bneq	sym.23

  552    2   	      ms_message2("New file: ",bu_file_name(bu));
                           52 63 02 78    0396		ashl	#2,(r3),r2
                              52 03 C0    039A		addl2	#3,r2
                                 62 DD    039D		pushl	(r2)
                              5F A4 DF    039F		pushal	95(r4)
                    00000000* EF 02 FB    03A2		calls	#2,MS_MESSAGE2

  553    2   	    bu_modified(bu) = 0;
                                          03A9	sym.23:
                           52 63 02 78    03A9		ashl	#2,(r3),r2
                              52 04 C0    03AD		addl2	#4,r2
                                 62 D4    03B0		clrl	(r2)

  554    2   	    }
  555    1   	  bu_map_sub_buffers(bu, bu2)
                                          03B2	sym.24:
                              52 63 D0    03B2		movl	(r3),r2
                                 23 13    03B5		beql	sym.27
                                    01    03B7		nop	
                                          03B8	sym.25:

  556    1   	    if (bu_gap(bu2) == null)
                           53 52 02 78    03B8		ashl	#2,r2,r3
                              53 0D C0    03BC		addl2	#13,r3
                                 63 D5    03BF		tstl	(r3)
                                 0B 12    03C1		bneq	sym.26

  557    1   	      tx_more_memory_please(bu2, 0);
                                 00 DD    03C3		pushl	#0
                                 52 DD    03C5		pushl	r2
                    00000000* EF 02 FB    03C7		calls	#2,TX_MORE_MEMORY_PLEASE

  558    1   	}
                                          03CE	sym.26:
                           53 52 02 78    03CE		ashl	#2,r2,r3
                              53 18 C0    03D2		addl2	#24,r3
                              52 63 D0    03D5		movl	(r3),r2
                                 DE 12    03D8		bneq	sym.25
                                          03DA	sym.27:
                                    04    03DA		ret	

  559        	
  560        	int q_bu_find_window(const char *na)
  561        	{
                                          03DB	q_bu_find_window:
                                    001C  03DB		.entry	q_bu_find_window,^m<r2,r3,r4>
                              5E 04 C2    03DD		subl2	#4,sp

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 10
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                     54 00000000 EF 9E    03E0		movab	SE_CURRENT_WINDOW,r4

  562    1   	  register bufferp bu;
  563    1   	  register windowp wi;
  564    1   	
  565    1   	  bu = bu_find_by_name(na);
                              04 AC DD    03E7		pushl	4(ap)
                    00000000* EF 01 FB    03EA		calls	#1,BU_FIND_BY_NAME
                              53 50 D0    03F1		movl	r0,r3

  566    1   	  if (bu == null)
                                 0D 12    03F4		bneq	sym.28

  567    1   	    return q_pop_to_buffer(null, na);
                              04 AC DD    03F6		pushl	4(ap)
                                 00 DD    03F9		pushl	#0
                    00000000* EF 02 FB    03FB		calls	#2,Q_POP_TO_BUFFER
                                    04    0402		ret	

  568    1   	  wi_map(se_windows, wi)
                                          0403	sym.28:
                  50 00000000 EF 02 78    0403		ashl	#2,SE_CURRENT_PAGE,r0
                              50 02 C0    040B		addl2	#2,r0
                              52 60 D0    040E		movl	(r0),r2
                                 29 13    0411		beql	sym.33
                                    01    0413		nop	
                                          0414	sym.29:

  569    1   	    if (wi_buffer(wi) == bu) {
                              53 62 D1    0414		cmpl	(r2),r3
                                 17 12    0417		bneq	sym.32

  570    2   	      while (wi != se_current_window)
                              64 52 D1    0419		cmpl	r2,(r4)
                                 0E 13    041C		beql	sym.31
                                 50 D5    041E		tstl	r0
                                          0420	sym.30:

  571    2   		next_window();
                    00000000* EF 00 FB    0420		calls	#0,NEXT_WINDOW
                              64 52 D1    0427		cmpl	r2,(r4)
                                 F4 12    042A		bneq	sym.30
                                          042C	sym.31:

  572    2   	      return true;
                              50 01 D0    042C		movl	#1,r0
                                    04    042F		ret	

  573    2   	      }
  574    1   	  return q_pop_to_buffer(bu, na);
                                          0430	sym.32:
                           50 52 02 78    0430		ashl	#2,r2,r0
                              50 09 C0    0434		addl2	#9,r0
                              52 60 D0    0437		movl	(r0),r2
                                 D8 12    043A		bneq	sym.29
                                          043C	sym.33:
                              04 AC DD    043C		pushl	4(ap)

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 11
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                 53 DD    043F		pushl	r3
                    00000000* EF 02 FB    0441		calls	#2,Q_POP_TO_BUFFER
                                    04    0448		ret	

  575    1   	}
  576        	
  577        	int q_bu_pop_up_message(register const char *msg, int mlen, const char *na)
  578        	{
                                          0449	q_bu_pop_up_message:
                                    07FC  0449		.entry	q_bu_pop_up_message,^m<r2,r3,r4,r5,r6,r7,r8,r9,r10>
                              5E 04 C2    044B		subl2	#4,sp
                     5A 00000000 EF 9E    044E		movab	$CHAR_STRING_CONSTANTS,r10
                     59 00000000 EF 9E    0455		movab	SE_CURRENT_WINDOW,r9
                           53 04 AC D0    045C		movl	4(ap),r3

  579    1   	  int all_blank, size, nlines;
  580    1   	  register int i;
  581    1   	  register windowp wi;
  582    1   	  bufferp bu;
  583    1   	
  584    1   	  wi = se_current_window;
                              54 69 D0    0460		movl	(r9),r4

  585    1   	  size = wi_size(wi);
                           55 54 02 78    0463		ashl	#2,r4,r5
                              55 03 C0    0467		addl2	#3,r5
                              52 65 D0    046A		movl	(r5),r2

  586    1   	  if (! q_pop_up_window())
                    00000000* EF 00 FB    046D		calls	#0,Q_POP_UP_WINDOW
                                 50 D5    0474		tstl	r0
                                 03 12    0476		bneq	sym.34

  587    1   	    return false;
                                 50 D4    0478		clrl	r0
                                    04    047A		ret	

  588    1   	  wi_size(wi) = max(1, size - 2);
                                          047B	sym.34:
                              52 02 C2    047B		subl2	#2,r2
                              52 01 D1    047E		cmpl	#1,r2
                                 05 15    0481		bleq	sym.35
                              56 01 D0    0483		movl	#1,r6
                                 03 11    0486		brb	sym.36
                                          0488	sym.35:
                              56 52 D0    0488		movl	r2,r6
                                          048B	sym.36:
                              65 56 D0    048B		movl	r6,(r5)

  589    1   	  wi_size(se_current_window) = 1;
                           52 69 02 78    048E		ashl	#2,(r9),r2
                              52 03 C0    0492		addl2	#3,r2
                              62 01 D0    0495		movl	#1,(r2)

  590    1   	  bu = bu_new(na, "");
                              6A AA DF    0498		pushal	106(r10)
                              0C AC DD    049B		pushl	12(ap)

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 12
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                    00000000* EF 02 FB    049E		calls	#2,BU_NEW

  591    1   	  if (q_switch_to_buffer(bu, st_buffer(bu_name(bu)))) {
                     55 00000000 EF DE    04A5		moval	MEMORY,r5
                           52 60 02 78    04AC		ashl	#2,(r0),r2
                              52 02 C0    04B0		addl2	#2,r2
                           7E 55 62 C1    04B3		addl3	(r2),r5,-(sp)
                                 50 DD    04B7		pushl	r0
                    00000000* EF 02 FB    04B9		calls	#2,Q_SWITCH_TO_BUFFER
                                 50 D5    04C0		tstl	r0
                                 03 12    04C2		bneq	gen.5
                               00D9 31    04C4		brw	sym.48
                                          04C7	gen.5:

  592    2   	    all_blank = true;
                              57 01 D0    04C7		movl	#1,r7

  593    2   	    nlines = 1;
                              58 01 D0    04CA		movl	#1,r8

  594    2   	    for (i = 0; i < mlen; ++i) {
                                 52 D4    04CD		clrl	r2
                           56 08 AC DE    04CF		moval	8(ap),r6
                              66 52 D1    04D3		cmpl	r2,(r6)
                                 63 18    04D6		bgeq	sym.43
                    55 00000000* EF 9E    04D8		movab	INSERT_CHARACTER,r5
                                    01    04DF		nop	
                                          04E0	sym.37:

  595    3   	      if (msg[i] == CR)
                            0D 6342 91    04E0		cmpb	(r3)[r2],#13
                                 1E 12    04E4		bneq	sym.39

  596    3   		if (i < mlen-1) {
                           50 66 01 C3    04E6		subl3	#1,(r6),r0
                              50 52 D1    04EA		cmpl	r2,r0
                                 0D 18    04ED		bgeq	sym.38

  597    4   		  if (msg[i+1] == LF)
                           50 52 01 C1    04EF		addl3	#1,r2,r0
                            0A 6340 91    04F3		cmpb	(r3)[r0],#10
                                 3B 13    04F7		beql	sym.42

  598    4   		    continue;
  599    4   		  }
  600    3   		else {
                                 09 11    04F9		brb	sym.39
                                    01    04FB		nop	
                                          04FC	sym.38:

  601    4   		  insert_character(NEWLINE);
                                 0A DD    04FC		pushl	#10
                              65 01 FB    04FE		calls	#1,(r5)

  602    4   		  continue;
                                 31 11    0501		brb	sym.42
                                    01    0503		nop	

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 13
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  603    4   		  }
                                          0504	sym.39:

  604    3   	      if (msg[i] == LF) {
                            0A 6342 91    0504		cmpb	(r3)[r2],#10
                                 16 12    0508		bneq	sym.40

  605    4   		insert_character(NEWLINE);
                                 0A DD    050A		pushl	#10
                              65 01 FB    050C		calls	#1,(r5)

  606    4   		if (i < mlen-1 && ! all_blank)
                           50 66 01 C3    050F		subl3	#1,(r6),r0
                              50 52 D1    0513		cmpl	r2,r0
                                 1C 18    0516		bgeq	sym.42
                                 57 D5    0518		tstl	r7
                                 18 12    051A		bneq	sym.42

  607    4   		  nlines = nlines + 1;
                                 58 D6    051C		incl	r8

  608    4   		}
  609    3   	      else {
                                 14 11    051E		brb	sym.42
                                          0520	sym.40:

  610    4   		if (all_blank) {
                                 57 D5    0520		tstl	r7
                                 09 13    0522		beql	sym.41

  611    5   		  line_to_top_of_window();
                    00000000* EF 00 FB    0524		calls	#0,LINE_TO_TOP_OF_WINDOW

  612    5   		  all_blank = false;
                                 57 D4    052B		clrl	r7

  613    5   		  }
  614    4   		insert_character(msg[i]);
                                          052D	sym.41:
                            7E 6342 98    052D		cvtbl	(r3)[r2],-(sp)
                              65 01 FB    0531		calls	#1,(r5)

  615    4   		}
                                          0534	sym.42:

  616    3   	      }
                                 52 D6    0534		incl	r2
                              66 52 D1    0536		cmpl	r2,(r6)
                                 A5 19    0539		blss	sym.37
                                          053B	sym.43:

  617    2   	    wi_dot(se_current_window) = wi_bow(se_current_window);
                           52 69 02 78    053B		ashl	#2,(r9),r2
                           53 52 01 C1    053F		addl3	#1,r2,r3
                              52 02 C0    0543		addl2	#2,r2
                              63 62 D0    0546		movl	(r2),(r3)


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 14
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  618    2   	    bu_modified(se_current_buffer) = 0;
                              52 69 D0    0549		movl	(r9),r2
                        52 00 B2 02 78    054C		ashl	#2,@0(r2),r2
                              52 04 C0    0551		addl2	#4,r2
                                 62 D4    0554		clrl	(r2)

  619    2   	    size = wi_size(wi);
                           53 54 02 78    0556		ashl	#2,r4,r3
                              53 03 C0    055A		addl2	#3,r3
                              56 63 D0    055D		movl	(r3),r6

  620    2   	    wi_size(wi) = max(1, wi_size(wi) - nlines + 1);
                           52 63 58 C3    0560		subl3	r8,(r3),r2
                                 52 D6    0564		incl	r2
                              52 01 D1    0566		cmpl	#1,r2
                                 05 15    0569		bleq	sym.44
                              55 01 D0    056B		movl	#1,r5
                                 03 11    056E		brb	sym.45
                                          0570	sym.44:
                              55 52 D0    0570		movl	r2,r5
                                          0573	sym.45:
                              63 55 D0    0573		movl	r5,(r3)

  621    2   	    wi_size(se_current_window) = wi_size(se_current_window) +
  622    2   								size - wi_size(wi);
                           52 69 02 78    0576		ashl	#2,(r9),r2
                              52 03 C0    057A		addl2	#3,r2
                              56 62 C0    057D		addl2	(r2),r6
                           62 56 63 C3    0580		subl3	(r3),r6,(r2)

  623    2   	    wi_fill();
                    00000000* EF 00 FB    0584		calls	#0,WI_FILL

  624    2   	    while (wi != se_current_window)
                              69 54 D1    058B		cmpl	r4,(r9)
                                 0C 13    058E		beql	sym.47
                                          0590	sym.46:

  625    2   	      next_window();
                    00000000* EF 00 FB    0590		calls	#0,NEXT_WINDOW
                              69 54 D1    0597		cmpl	r4,(r9)
                                 F4 12    059A		bneq	sym.46
                                          059C	sym.47:

  626    2   	    return true;
                              50 01 D0    059C		movl	#1,r0
                                    04    059F		ret	

  627    2   	    }
  628    1   	  else
                                          05A0	sym.48:

  629    1   	    return false;
                                 50 D4    05A0		clrl	r0
                                    04    05A2		ret	

  630    1   	}

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 15
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  631        	
  632        	bufferp bu_find_by_file_name(const char *na)
  633        	{
                                          05A3	bu_find_by_file_name:
                                    000C  05A3		.entry	bu_find_by_file_name,^m<r2,r3>
                              5E 04 C2    05A5		subl2	#4,sp
                     53 00000000 EF 9E    05A8		movab	MEMORY,r3

  634    1   	  register bufferp bu;
  635    1   	
  636    1   	  bu_map(se_buffers,bu)
                     52 00000000 EF D0    05AF		movl	SE_BUFFERS,r2
                                 32 13    05B6		beql	sym.51
                                          05B8	sym.49:

  637    1   	    if (bu_file_name(bu) != null)
                              50 62 D0    05B8		movl	(r2),r0
                           51 50 02 78    05BB		ashl	#2,r0,r1
                              51 03 C0    05BF		addl2	#3,r1
                                 61 D5    05C2		tstl	(r1)
                                 19 13    05C4		beql	sym.50

  638    1   	      if (q_ho_equal(st_buffer(bu_file_name(bu)), na))
                              04 AC DD    05C6		pushl	4(ap)
                              50 63 DE    05C9		moval	(r3),r0
                           7E 50 61 C1    05CC		addl3	(r1),r0,-(sp)
                    00000000* EF 02 FB    05D0		calls	#2,Q_HO_EQUAL
                                 50 D5    05D7		tstl	r0
                                 04 13    05D9		beql	sym.50

  639    1   		return bu;
                              50 52 D0    05DB		movl	r2,r0
                                    04    05DE		ret	

  640    1   	  return null;
                                          05DF	sym.50:
                           50 62 02 78    05DF		ashl	#2,(r2),r0
                                 50 D6    05E3		incl	r0
                              52 60 D0    05E5		movl	(r0),r2
                                 CE 12    05E8		bneq	sym.49
                                          05EA	sym.51:
                                 50 D4    05EA		clrl	r0
                                    04    05EC		ret	

  641    1   	}
  642        	
  643        	bufferp bu_find_by_name(const char *na)
  644        	{
                                          05ED	bu_find_by_name:
                                    000C  05ED		.entry	bu_find_by_name,^m<r2,r3>
                              5E 04 C2    05EF		subl2	#4,sp
                     53 00000000 EF 9E    05F2		movab	MEMORY,r3

  645    1   	  register bufferp bu;
  646    1   	
  647    1   	  bu_map(se_buffers,bu)
                     52 00000000 EF D0    05F9		movl	SE_BUFFERS,r2

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 16
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                 34 13    0600		beql	sym.54
                                 50 D5    0602		tstl	r0
                                          0604	sym.52:

  648    1   	    if (bu_name(bu) != null)
                              50 62 D0    0604		movl	(r2),r0
                           51 50 02 78    0607		ashl	#2,r0,r1
                              51 02 C0    060B		addl2	#2,r1
                                 61 D5    060E		tstl	(r1)
                                 19 13    0610		beql	sym.53

  649    1   	      if (q_ho_equal(st_buffer(bu_name(bu)), na))
                              04 AC DD    0612		pushl	4(ap)
                              50 63 DE    0615		moval	(r3),r0
                           7E 50 61 C1    0618		addl3	(r1),r0,-(sp)
                    00000000* EF 02 FB    061C		calls	#2,Q_HO_EQUAL
                                 50 D5    0623		tstl	r0
                                 04 13    0625		beql	sym.53

  650    1   		return bu;
                              50 52 D0    0627		movl	r2,r0
                                    04    062A		ret	

  651    1   	  return null;
                                          062B	sym.53:
                           50 62 02 78    062B		ashl	#2,(r2),r0
                                 50 D6    062F		incl	r0
                              52 60 D0    0631		movl	(r0),r2
                                 CE 12    0634		bneq	sym.52
                                          0636	sym.54:
                                 50 D4    0636		clrl	r0
                                    04    0638		ret	

  652    1   	}
  653        	
  654        	bufferp bu_new(const char *name, const char *fname)
  655        	{
                                          0639	bu_new:
                                    007C  0639		.entry	bu_new,^m<r2,r3,r4,r5,r6>
                              5E 04 C2    063B		subl2	#4,sp

  656    1   	  register bufferp bu;
  657    1   	  static bufferp bu_last_buffer = null;
  658    1   	
  659    1   	  bu = me_allocate(bu_sizeof);
                                 19 DD    063E		pushl	#25
                    00000000* EF 01 FB    0640		calls	#1,ME_ALLOCATE
                              52 50 D0    0647		movl	r0,r2

  660    1   	  bu_parent(bu) = bu;
                              62 52 D0    064A		movl	r2,(r2)

  661    1   	  bu_next(bu) = null;
                           50 62 02 78    064D		ashl	#2,(r2),r0
                                 50 D6    0651		incl	r0
                                 60 D4    0653		clrl	(r0)


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 17
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  662    1   	  bu_sub_buffers(bu) = null;
                           55 52 02 78    0655		ashl	#2,r2,r5
                           50 55 18 C1    0659		addl3	#24,r5,r0
                                 60 D4    065D		clrl	(r0)

  663    1   	  bu_name(bu) = null;
                           50 62 02 78    065F		ashl	#2,(r2),r0
                              50 02 C0    0663		addl2	#2,r0
                                 60 D4    0666		clrl	(r0)

  664    1   	  bu_file_name(bu) = null;
                           50 62 02 78    0668		ashl	#2,(r2),r0
                              50 03 C0    066C		addl2	#3,r0
                                 60 D4    066F		clrl	(r0)

  665    1   	  if (fname[0] != EOS)
                           56 08 AC D0    0671		movl	8(ap),r6
                                 66 95    0675		tstb	(r6)
                                 0F 13    0677		beql	sym.55

  666    1   	    bu_modified(bu) = 2;			/* file, not read in yet */
                           50 62 02 78    0679		ashl	#2,(r2),r0
                              50 04 C0    067D		addl2	#4,r0
                              60 02 D0    0680		movl	#2,(r0)

  667    1   	  else
                                 0C 11    0683		brb	sym.56
                                 50 D5    0685		tstl	r0
                                    01    0687		nop	
                                          0688	sym.55:

  668    1   	    bu_modified(bu) = 0;
                           50 62 02 78    0688		ashl	#2,(r2),r0
                              50 04 C0    068C		addl2	#4,r0
                                 60 D4    068F		clrl	(r0)
                                          0691	sym.56:

  669    1   	  bu_type(bu) = 0;
                           50 62 02 78    0691		ashl	#2,(r2),r0
                              50 05 C0    0695		addl2	#5,r0
                                 60 D4    0698		clrl	(r0)

  670    1   	  bu_mappings(bu) = null;
                           50 62 02 78    069A		ashl	#2,(r2),r0
                              50 06 C0    069E		addl2	#6,r0
                                 60 D4    06A1		clrl	(r0)

  671    1   	  bu_protection(bu) = -1;
                           50 62 02 78    06A3		ashl	#2,(r2),r0
                              50 07 C0    06A7		addl2	#7,r0
                              60 01 CE    06AA		mnegl	#1,(r0)

  672    1   	  bu_indent(bu) = 1;
                           50 62 02 78    06AD		ashl	#2,(r2),r0
                              50 08 C0    06B1		addl2	#8,r0
                              60 01 D0    06B4		movl	#1,(r0)


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 18
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  673    1   	  bu_case(bu) = se_default_case;
                           50 62 02 78    06B7		ashl	#2,(r2),r0
                              50 09 C0    06BB		addl2	#9,r0
                     60 00000000 EF D0    06BE		movl	SE_DEFAULT_CASE,(r0)

  674    1   	  bu_windows(bu) = null;
                           50 55 0A C1    06C5		addl3	#10,r5,r0
                                 60 D4    06C9		clrl	(r0)

  675    1   	  bu_size(bu) = 0;
                           50 55 0B C1    06CB		addl3	#11,r5,r0
                                 60 D4    06CF		clrl	(r0)

  676    1   	  bu_base(bu) = null - 1;
                           50 55 0C C1    06D1		addl3	#12,r5,r0
                              60 01 CE    06D5		mnegl	#1,(r0)

  677    1   	  bu_gap(bu) = null;
                           50 55 0D C1    06D8		addl3	#13,r5,r0
                                 60 D4    06DC		clrl	(r0)

  678    1   	  bu_gap_size(bu) = 0;
                           50 55 0E C1    06DE		addl3	#14,r5,r0
                                 60 D4    06E2		clrl	(r0)

  679    1   	  bu_dot(bu) = 1;
                           50 55 0F C1    06E4		addl3	#15,r5,r0
                              60 01 D0    06E8		movl	#1,(r0)

  680    1   	  bu_bow(bu) = 1;
                           50 55 10 C1    06EB		addl3	#16,r5,r0
                              60 01 D0    06EF		movl	#1,(r0)

  681    1   	  bu_save_dot_ptr(bu) = mk_new(1);
                           53 55 11 C1    06F2		addl3	#17,r5,r3
                                 01 DD    06F6		pushl	#1
                    54 00000000* EF 9E    06F8		movab	MK_NEW,r4
                              64 01 FB    06FF		calls	#1,(r4)
                              63 50 D0    0702		movl	r0,(r3)

  682    1   	  bu_save_bow_ptr(bu) = mk_new(1);
                           53 55 12 C1    0705		addl3	#18,r5,r3
                                 01 DD    0709		pushl	#1
                              64 01 FB    070B		calls	#1,(r4)
                              63 50 D0    070E		movl	r0,(r3)

  683    1   	  bu_mark1_ptr(bu) = mk_new(0);
                           53 55 13 C1    0711		addl3	#19,r5,r3
                                 00 DD    0715		pushl	#0
                              64 01 FB    0717		calls	#1,(r4)
                              63 50 D0    071A		movl	r0,(r3)

  684    1   	  bu_mark2_ptr(bu) = mk_new(0);
                           53 55 14 C1    071D		addl3	#20,r5,r3
                                 00 DD    0721		pushl	#0
                              64 01 FB    0723		calls	#1,(r4)
                              63 50 D0    0726		movl	r0,(r3)

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 19
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  685    1   	  bu_markers(bu) = null;
                           50 55 15 C1    0729		addl3	#21,r5,r0
                                 60 D4    072D		clrl	(r0)

  686    1   	  bu_id(bu) = 0;
                           50 55 16 C1    072F		addl3	#22,r5,r0
                                 60 D4    0733		clrl	(r0)

  687    1   	  bu_current(bu) = 1;
                              55 17 C0    0735		addl2	#23,r5
                              65 01 D0    0738		movl	#1,(r5)

  688    1   	  if (name[0] != EOS || fname[0] != EOS) {	/* if not a sub-buffer... */
                           53 04 AC D0    073B		movl	4(ap),r3
                                 63 95    073F		tstb	(r3)
                                 04 12    0741		bneq	sym.57
                                 66 95    0743		tstb	(r6)
                                 32 13    0745		beql	sym.60
                                          0747	sym.57:

  689    2   	    if (bu_last_buffer == null)
                     50 00000000 EF D0    0747		movl	$DATA,r0
                                 0C 12    074E		bneq	sym.58

  690    2   	      se_buffers = bu;
                     00000000 EF 52 D0    0750		movl	r2,SE_BUFFERS

  691    2   	    else
                                 0C 11    0757		brb	sym.59
                                 50 D5    0759		tstl	r0
                                    01    075B		nop	
                                          075C	sym.58:

  692    2   	      bu_next(bu_last_buffer) = bu;
                           50 60 02 78    075C		ashl	#2,(r0),r0
                                 50 D6    0760		incl	r0
                              60 52 D0    0762		movl	r2,(r0)
                                          0765	sym.59:

  693    2   	    bu_last_buffer = bu;
                     00000000 EF 52 D0    0765		movl	r2,$DATA

  694    2   	    bu_new_names(bu, name, fname);
                                 56 DD    076C		pushl	r6
                                 53 DD    076E		pushl	r3
                                 52 DD    0770		pushl	r2
                    00000000* EF 03 FB    0772		calls	#3,BU_NEW_NAMES

  695    2   	    }
  696    1   	  return bu;
                                          0779	sym.60:
                              50 52 D0    0779		movl	r2,r0
                                    04    077C		ret	

  697    1   	}
  698        	
  699        	bufferp bu_new_sub_buffer(bufferp parent, int id)

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 20
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  700        	{
                                          077D	bu_new_sub_buffer:
                                    000C  077D		.entry	bu_new_sub_buffer,^m<r2,r3>
                              5E 04 C2    077F		subl2	#4,sp
                     53 00000000 EF 9E    0782		movab	$CHAR_STRING_CONSTANTS,r3

  701    1   	  register bufferp bu;
  702    1   	
  703    1   	  bu = bu_new("", "");
                              6C A3 DF    0789		pushal	108(r3)
                              6B A3 DF    078C		pushal	107(r3)
                    00000000* EF 02 FB    078F		calls	#2,BU_NEW
                              52 50 D0    0796		movl	r0,r2

  704    1   	  bu_parent(bu) = parent;
                           62 04 AC D0    0799		movl	4(ap),(r2)

  705    1   	  bu_id(bu) = id;
                           51 52 02 78    079D		ashl	#2,r2,r1
                           50 51 16 C1    07A1		addl3	#22,r1,r0
                           60 08 AC D0    07A5		movl	8(ap),(r0)

  706    1   	  bu_current(bu) = 0;
                              51 17 C0    07A9		addl2	#23,r1
                                 61 D4    07AC		clrl	(r1)

  707    1   	  return bu;
                              50 52 D0    07AE		movl	r2,r0
                                    04    07B1		ret	

  708    1   	}
  709        	
  710        	/* Should deallocate unused space! */
  711        	bufferp bu_delete_sub_buffer(register bufferp bu)
  712        	{
                                          07B2	bu_delete_sub_buffer:
                                    0000  07B2		.entry	bu_delete_sub_buffer,^m<>
                              5E 04 C2    07B4		subl2	#4,sp

  713    1   	  return bu_sub_buffers(bu);
                        50 04 AC 02 78    07B7		ashl	#2,4(ap),r0
                              50 18 C0    07BC		addl2	#24,r0
                              50 60 D0    07BF		movl	(r0),r0
                                    04    07C2		ret	

  714    1   	}
  715        	
  716        	void bu_new_names(register bufferp bu, const char *name, const char *fname)
  717        	{
                                          07C3	bu_new_names:
                                    01FC  07C3		.entry	bu_new_names,^m<r2,r3,r4,r5,r6,r7,r8>
                              5E 14 C2    07C5		subl2	#20,sp
                     57 00000000 EF 9E    07C8		movab	MEMORY,r7
                           52 04 AC D0    07CF		movl	4(ap),r2

  718    1   	  register windowp wi;
  719    1   	  char num[14];

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 21
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  720    1   	  stringp old, st, st2;
  721    1   	  int sl, n, nl;
  722    1   	
  723    1   	  old = bu_name(bu);
                           53 62 02 78    07D3		ashl	#2,(r2),r3
                              53 02 C0    07D7		addl2	#2,r3
                              58 63 D0    07DA		movl	(r3),r8

  724    1   	  bu_name(bu) = null;
                           53 62 02 78    07DD		ashl	#2,(r2),r3
                              53 02 C0    07E1		addl2	#2,r3
                                 63 D4    07E4		clrl	(r3)

  725    1   	  st_deallocate(bu_file_name(bu));
                           53 62 02 78    07E6		ashl	#2,(r2),r3
                              53 03 C0    07EA		addl2	#3,r3
                                 63 DD    07ED		pushl	(r3)
                    00000000* EF 01 FB    07EF		calls	#1,ST_DEALLOCATE

  726    1   	  if (name[0] != EOS) {
                           54 08 AC D0    07F6		movl	8(ap),r4
                                 64 95    07FA		tstb	(r4)
                                 5E 13    07FC		beql	sym.62

  727    2   	    st = st_allocate(ho_length(name)+1);
                                 54 DD    07FE		pushl	r4
                    00000000* EF 01 FB    0800		calls	#1,HO_LENGTH
                                 50 D6    0807		incl	r0
                                 50 DD    0809		pushl	r0
                    00000000* EF 01 FB    080B		calls	#1,ST_ALLOCATE
                              56 50 D0    0812		movl	r0,r6

  728    2   	    ho_scopy(name, 1, st_buffer(st), 1);
                                 01 DD    0815		pushl	#1
                              53 67 DE    0817		moval	(r7),r3
                           7E 53 56 C1    081A		addl3	r6,r3,-(sp)
                                 01 DD    081E		pushl	#1
                                 54 DD    0820		pushl	r4
                    00000000* EF 04 FB    0822		calls	#4,HO_SCOPY

  729    2   	    for (st2 = st; *st_buffer(st2) != EOS; st2++)
                              54 56 D0    0829		movl	r6,r4
                              53 67 DE    082C		moval	(r7),r3
                              53 54 C0    082F		addl2	r4,r3
                                 63 95    0832		tstb	(r3)
                                 33 13    0834		beql	sym.63
                                 50 D5    0836		tstl	r0
                                          0838	sym.61:

  730    2   	      *st_buffer(st2) = ho_clower(*st_buffer(st2));
                              53 67 DE    0838		moval	(r7),r3
                              53 54 C0    083B		addl2	r4,r3
                              7E 63 98    083E		cvtbl	(r3),-(sp)
                    00000000* EF 01 FB    0841		calls	#1,HO_CLOWER
                              63 50 90    0848		movb	r0,(r3)
                                 54 D6    084B		incl	r4
                              50 67 DE    084D		moval	(r7),r0

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 22
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                              50 54 C0    0850		addl2	r4,r0
                                 60 95    0853		tstb	(r0)
                                 E1 12    0855		bneq	sym.61

  731    2   	    }
  732    1   	  else
                                 10 11    0857		brb	sym.63
                                 50 D5    0859		tstl	r0
                                    01    085B		nop	
                                          085C	sym.62:

  733    1   	    st = bu_make_name(fname);
                              0C AC DD    085C		pushl	12(ap)
                    00000000* EF 01 FB    085F		calls	#1,BU_MAKE_NAME
                              56 50 D0    0866		movl	r0,r6
                                          0869	sym.63:

  734    1   	  if (fname[0] != EOS) {
                           55 0C AC D0    0869		movl	12(ap),r5
                                 65 95    086D		tstb	(r5)
                                 3B 13    086F		beql	sym.64

  735    2   	    bu_file_name(bu) = st_allocate(ho_length(fname)+1);
                           53 62 02 78    0871		ashl	#2,(r2),r3
                              53 03 C0    0875		addl2	#3,r3
                                 55 DD    0878		pushl	r5
                    00000000* EF 01 FB    087A		calls	#1,HO_LENGTH
                                 50 D6    0881		incl	r0
                                 50 DD    0883		pushl	r0
                    00000000* EF 01 FB    0885		calls	#1,ST_ALLOCATE
                              63 50 D0    088C		movl	r0,(r3)

  736    2   	    ho_scopy(fname, 1, st_buffer(bu_file_name(bu)), 1);
                                 01 DD    088F		pushl	#1
                              54 67 DE    0891		moval	(r7),r4
                           53 62 02 78    0894		ashl	#2,(r2),r3
                              53 03 C0    0898		addl2	#3,r3
                           7E 54 63 C1    089B		addl3	(r3),r4,-(sp)
                                 01 DD    089F		pushl	#1
                                 55 DD    08A1		pushl	r5
                    00000000* EF 04 FB    08A3		calls	#4,HO_SCOPY

  737    2   	    }
  738    1   	  else
                                 09 11    08AA		brb	sym.65
                                          08AC	sym.64:

  739    1   	    bu_file_name(bu) = null;
                           53 62 02 78    08AC		ashl	#2,(r2),r3
                              53 03 C0    08B0		addl2	#3,r3
                                 63 D4    08B3		clrl	(r3)
                                          08B5	sym.65:

  740    1   	  sl = st_length(st);
                                 56 DD    08B5		pushl	r6
                    00000000* EF 01 FB    08B7		calls	#1,ST_LENGTH
                              55 50 D0    08BE		movl	r0,r5

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 23
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  741    1   	  for (n = 2; bu_find_by_name(st_buffer(st)) != null; n++) {
                              54 02 D0    08C1		movl	#2,r4
                              53 67 DE    08C4		moval	(r7),r3
                           7E 53 56 C1    08C7		addl3	r6,r3,-(sp)
                    00000000* EF 01 FB    08CB		calls	#1,BU_FIND_BY_NAME
                                 50 D5    08D2		tstl	r0
                                 03 12    08D4		bneq	gen.6
                               0082 31    08D6		brw	sym.67
                                          08D9	gen.6:
                                 50 D5    08D9		tstl	r0
                                    01    08DB		nop	
                                          08DC	sym.66:

  742    2   	    nl = ho_itoc(n, num + 1, 12);
                                 0C DD    08DC		pushl	#12
                           50 EE AD DE    08DE		moval	-18(fp),r0
                                 50 D6    08E2		incl	r0
                                 50 DD    08E4		pushl	r0
                                 54 DD    08E6		pushl	r4
                    00000000* EF 03 FB    08E8		calls	#3,HO_ITOC
                              51 50 D0    08EF		movl	r0,r1

  743    2   	    num[0] = '<';
                           EE AD 3C 90    08F2		movb	#60,-18(fp)

  744    2   	    num[1+nl] = '>';
                           50 51 01 C1    08F6		addl3	#1,r1,r0
                         EE AD40 3E 90    08FA		movb	#62,-18(fp)[r0]

  745    2   	    num[2+nl] = EOS;
                           50 51 02 C1    08FF		addl3	#2,r1,r0
                            EE AD40 94    0903		clrb	-18(fp)[r0]

  746    2   	    st2 = st_allocate(3+nl+sl);
                              51 03 C0    0907		addl2	#3,r1
                           7E 51 55 C1    090A		addl3	r5,r1,-(sp)
                    00000000* EF 01 FB    090E		calls	#1,ST_ALLOCATE
                              53 50 D0    0915		movl	r0,r3

  747    2   	    st_scopy(st, st2);
                                 53 DD    0918		pushl	r3
                                 56 DD    091A		pushl	r6
                    00000000* EF 02 FB    091C		calls	#2,ST_SCOPY

  748    2   	    ho_scopy(num, 1, st_buffer(st2+sl), 1);
                                 01 DD    0923		pushl	#1
                              50 67 DE    0925		moval	(r7),r0
                              50 53 C0    0928		addl2	r3,r0
                           7E 50 55 C1    092B		addl3	r5,r0,-(sp)
                                 01 DD    092F		pushl	#1
                              EE AD DF    0931		pushal	-18(fp)
                    00000000* EF 04 FB    0934		calls	#4,HO_SCOPY

  749    2   	    st_deallocate(st);
                                 56 DD    093B		pushl	r6
                    00000000* EF 01 FB    093D		calls	#1,ST_DEALLOCATE


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 24
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  750    2   	    st = st2;
                              56 53 D0    0944		movl	r3,r6

  751    2   	    }
                                 54 D6    0947		incl	r4
                              50 67 DE    0949		moval	(r7),r0
                           7E 50 56 C1    094C		addl3	r6,r0,-(sp)
                    00000000* EF 01 FB    0950		calls	#1,BU_FIND_BY_NAME
                                 50 D5    0957		tstl	r0
                                 81 12    0959		bneq	sym.66
                                          095B	sym.67:

  752    1   	  bu_name(bu) = st;
                           53 62 02 78    095B		ashl	#2,(r2),r3
                              53 02 C0    095F		addl2	#2,r3
                              63 56 D0    0962		movl	r6,(r3)

  753    1   	  if (old != null) {				/* update old pointers */
                                 58 D5    0965		tstl	r8
                                 3E 13    0967		beql	sym.71

  754    2   	    bu_map_windows(bu, wi)
                           53 52 02 78    0969		ashl	#2,r2,r3
                              53 0A C0    096D		addl2	#10,r3
                              50 63 D0    0970		movl	(r3),r0
                                 29 13    0973		beql	sym.70
                                 50 D5    0975		tstl	r0
                                    01    0977		nop	
                                          0978	sym.68:

  755    2   	      if (wi_mode_line(wi) == old) {
                           54 50 02 78    0978		ashl	#2,r0,r4
                           53 54 08 C1    097C		addl3	#8,r4,r3
                              58 63 D1    0980		cmpl	(r3),r8
                                 11 12    0983		bneq	sym.69

  756    3   		wi_mode_line(wi) = bu_name(bu);
                           51 62 02 78    0985		ashl	#2,(r2),r1
                              51 02 C0    0989		addl2	#2,r1
                              63 61 D0    098C		movl	(r1),(r3)

  757    3   		wi_modified(wi) = 1;
                           51 54 06 C1    098F		addl3	#6,r4,r1
                              61 01 D0    0993		movl	#1,(r1)

  758    3   		}
  759    2   	    st_deallocate(old);
                                          0996	sym.69:
                              54 0D C0    0996		addl2	#13,r4
                              50 64 D0    0999		movl	(r4),r0
                                 DA 12    099C		bneq	sym.68
                                          099E	sym.70:
                                 58 DD    099E		pushl	r8
                    00000000* EF 01 FB    09A0		calls	#1,ST_DEALLOCATE

  760    2   	    }
  761    1   	  mp_set_mappings(bu, 0);

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 25
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                          09A7	sym.71:
                                 00 DD    09A7		pushl	#0
                                 52 DD    09A9		pushl	r2
                    00000000* EF 02 FB    09AB		calls	#2,MP_SET_MAPPINGS

  762    1   	}
                                    04    09B2		ret	

  763        	
  764        	bufferp bu_make_name(const char *file)
  765        	{
                                          09B3	bu_make_name:
                                    00FC  09B3		.entry	bu_make_name,^m<r2,r3,r4,r5,r6,r7>
                              5E 04 C2    09B5		subl2	#4,sp
                     57 00000000 EF 9E    09B8		movab	MEMORY,r7

  766    1   	  register int i, j, k;
  767    1   	  bufferp bu;
  768    1   	
  769    1   	  i = 0;
                                 53 D4    09BF		clrl	r3

  770    1   	  for (j = ho_nuqcp(file, 1); file[j-1] != EOS; j = ho_nuqcp(file, j+1))
                                 01 DD    09C1		pushl	#1
                           55 04 AC DE    09C3		moval	4(ap),r5
                              56 65 D0    09C7		movl	(r5),r6
                                 56 DD    09CA		pushl	r6
                    00000000* EF 02 FB    09CC		calls	#2,HO_NUQCP
                              52 50 D0    09D3		movl	r0,r2
                           54 52 01 C3    09D6		subl3	#1,r2,r4
                               6644 95    09DA		tstb	(r6)[r4]
                                 3B 13    09DD		beql	sym.75
                         54 0000 C5 D0    09DF		movl	0(r5),r4
                                          09E4	sym.72:

  771    1   	    if (file[j-1] == ']' || file[j-1] == '>' || file[j-1] == ':')
                           50 52 01 C3    09E4		subl3	#1,r2,r0
                         5D 8F 6440 91    09E8		cmpb	(r4)[r0],#93
                                 0E 13    09ED		beql	sym.73
                         3E 00 B540 91    09EF		cmpb	@0(r5)[r0],#62
                                 07 13    09F4		beql	sym.73
                         3A 00 B540 91    09F6		cmpb	@0(r5)[r0],#58
                                 03 12    09FB		bneq	sym.74
                                          09FD	sym.73:

  772    1   	      i = j;
                              53 52 D0    09FD		movl	r2,r3

  773    1   	  bu = st_allocate(j - i);
                                          0A00	sym.74:
                           50 52 01 C1    0A00		addl3	#1,r2,r0
                              7E 50 98    0A04		cvtbl	r0,-(sp)
                                 54 DD    0A07		pushl	r4
                    00000000* EF 02 FB    0A09		calls	#2,HO_NUQCP
                              52 50 D0    0A10		movl	r0,r2
                                 50 D7    0A13		decl	r0
                               6440 95    0A15		tstb	(r4)[r0]

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 26
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                 CA 12    0A18		bneq	sym.72
                                          0A1A	sym.75:
                           7E 52 53 C3    0A1A		subl3	r3,r2,-(sp)
                    00000000* EF 01 FB    0A1E		calls	#1,ST_ALLOCATE
                              56 50 D0    0A25		movl	r0,r6

  774    1   	  i = i + 1;
                                 53 D6    0A28		incl	r3

  775    1   	  for (k = i; k <= j; k++)
                              50 53 D0    0A2A		movl	r3,r0
                              52 50 D1    0A2D		cmpl	r0,r2
                                 21 14    0A30		bgtr	sym.77
                         55 0004 CC D0    0A32		movl	4(ap),r5
                                    01    0A37		nop	
                                          0A38	sym.76:

  776    1   	    *st_buffer(bu + k - i) = file[k-1];
                              54 67 DE    0A38		moval	(r7),r4
                              54 56 C0    0A3B		addl2	r6,r4
                              54 50 C0    0A3E		addl2	r0,r4
                              54 53 C2    0A41		subl2	r3,r4
                           51 50 01 C3    0A44		subl3	#1,r0,r1
                            64 6541 90    0A48		movb	(r5)[r1],(r4)
                                 50 D6    0A4C		incl	r0
                              52 50 D1    0A4E		cmpl	r0,r2
                                 E5 15    0A51		bleq	sym.76
                                          0A53	sym.77:

  777    1   	  return bu;
                              50 56 D0    0A53		movl	r6,r0
                                    04    0A56		ret	

  778    1   	}
  779        	
  780        	void bu_clear_text(register bufferp bu)
  781        	{
                                          0A57	bu_clear_text:
                                    03FC  0A57		.entry	bu_clear_text,^m<r2,r3,r4,r5,r6,r7,r8,r9>
                              5E 04 C2    0A59		subl2	#4,sp
                           53 04 AC D0    0A5C		movl	4(ap),r3

  782    1   	  register bufferp sb;
  783    1   	  textind save_dot, save_bow;
  784    1   	
  785    1   	  bu_map_sub_buffers(bu, sb) {
                              52 63 D0    0A60		movl	(r3),r2
                                 03 12    0A63		bneq	gen.7
                               00A0 31    0A65		brw	sym.81
                                          0A68	gen.7:
                    59 00000000* EF 9E    0A68		movab	MK_SET_MARK,r9
                                    01    0A6F		nop	
                                          0A70	sym.78:

  786    2   	    if (bu_modified(sb) != 2) {		/* don't mess with "unread file" buffers */
                           50 62 02 78    0A70		ashl	#2,(r2),r0
                              50 04 C0    0A74		addl2	#4,r0

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 27
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                              02 60 D1    0A77		cmpl	(r0),#2
                                 7D 13    0A7A		beql	sym.80

  787    3   	      save_dot = bu_save_dot(sb);	/* so that restores work properly */
                           54 52 02 78    0A7C		ashl	#2,r2,r4
                           56 54 11 C1    0A80		addl3	#17,r4,r6
                           50 66 02 78    0A84		ashl	#2,(r6),r0
                                 50 D6    0A88		incl	r0
                              58 60 D0    0A8A		movl	(r0),r8

  788    3   	      save_bow = bu_save_bow(sb);
                           55 54 12 C1    0A8D		addl3	#18,r4,r5
                           50 65 02 78    0A91		ashl	#2,(r5),r0
                                 50 D6    0A95		incl	r0
                              57 60 D0    0A97		movl	(r0),r7

  789    3   	      tx_delete(sb, 1, bu_size(sb));
                           50 54 0B C1    0A9A		addl3	#11,r4,r0
                                 60 DD    0A9E		pushl	(r0)
                                 01 DD    0AA0		pushl	#1
                                 52 DD    0AA2		pushl	r2
                    00000000* EF 03 FB    0AA4		calls	#3,TX_DELETE

  790    3   	      mk_set_mark(bu_mark1_ptr(sb), 0, sb);
                                 52 DD    0AAB		pushl	r2
                                 00 DD    0AAD		pushl	#0
                           50 54 13 C1    0AAF		addl3	#19,r4,r0
                                 60 DD    0AB3		pushl	(r0)
                              69 03 FB    0AB5		calls	#3,(r9)

  791    3   	      mk_set_mark(bu_mark2_ptr(sb), 0, sb);
                                 52 DD    0AB8		pushl	r2
                                 00 DD    0ABA		pushl	#0
                           50 54 14 C1    0ABC		addl3	#20,r4,r0
                                 60 DD    0AC0		pushl	(r0)
                              69 03 FB    0AC2		calls	#3,(r9)

  792    3   	      mk_set_mark(bu_save_dot_ptr(sb), save_dot, sb);
                                 52 DD    0AC5		pushl	r2
                                 58 DD    0AC7		pushl	r8
                                 66 DD    0AC9		pushl	(r6)
                              69 03 FB    0ACB		calls	#3,(r9)

  793    3   	      mk_set_mark(bu_save_bow_ptr(sb), save_bow, sb);
                                 52 DD    0ACE		pushl	r2
                                 57 DD    0AD0		pushl	r7
                                 65 DD    0AD2		pushl	(r5)
                              69 03 FB    0AD4		calls	#3,(r9)

  794    3   	      bu_dot(sb) = 1;
                           50 54 0F C1    0AD7		addl3	#15,r4,r0
                              60 01 D0    0ADB		movl	#1,(r0)

  795    3   	      bu_bow(sb) = 1;
                           50 54 10 C1    0ADE		addl3	#16,r4,r0
                              60 01 D0    0AE2		movl	#1,(r0)


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 28
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  796    3   	      if (sb == bu)
                              53 52 D1    0AE5		cmpl	r2,r3
                                 0A 12    0AE8		bneq	sym.79

  797    3   		bu_current(sb) = 1;
                           50 54 17 C1    0AEA		addl3	#23,r4,r0
                              60 01 D0    0AEE		movl	#1,(r0)

  798    3   	      else
                                 06 11    0AF1		brb	sym.80
                                    01    0AF3		nop	
                                          0AF4	sym.79:

  799    3   		bu_current(sb) = 0;
                              54 17 C0    0AF4		addl2	#23,r4
                                 64 D4    0AF7		clrl	(r4)
                                          0AF9	sym.80:

  800    3   	      }
  801    2   	    }
                           50 52 02 78    0AF9		ashl	#2,r2,r0
                              50 18 C0    0AFD		addl2	#24,r0
                              52 60 D0    0B00		movl	(r0),r2
                                 03 13    0B03		beql	gen.8
                               FF68 31    0B05		brw	sym.78
                                          0B08	gen.8:
                                          0B08	sym.81:

  802    1   	  if (mod(bu_modified(bu), 2) == 1)
                              52 63 D0    0B08		movl	(r3),r2
                           54 52 02 78    0B0B		ashl	#2,r2,r4
                              54 04 C0    0B0F		addl2	#4,r4
                        50 64 00 00 7A    0B12		emul	#0,#0,(r4),r0
                        50 51 50 02 7B    0B17		ediv	#2,r0,r1,r0
                              52 50 D0    0B1C		movl	r0,r2
                              01 52 D1    0B1F		cmpl	r2,#1
                                 02 12    0B22		bneq	sym.82

  803    1   	    bu_modified(bu) = 0;
                                 64 D4    0B24		clrl	(r4)

  804    1   	}
                                          0B26	sym.82:
                                    04    0B26		ret	

  805        	
  806        	#include "screen.cmn"
  826        	int q_buffer_list(void)
  827        	{
                                          0B27	q_buffer_list:
                                    0FFC  0B27		.entry	q_buffer_list,^m<r2,r3,r4,r5,r6,r7,r8,r9,r10,r11>
                              5E 28 C2    0B29		subl2	#40,sp
                     57 00000000 EF 9E    0B2C		movab	$CHAR_STRING_CONSTANTS,r7
                     5B 00000000 EF 9E    0B33		movab	MEMORY,r11

  828    1   	  int flen, nlen, curcol, do_files;
  829    1   	  static const char head[] = "  Name\t\t\tSize    Page    Filename\n\n";

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 29
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  830    1   	  char num[9];
  831    1   	  pagep pacurrent;
  832    1   	  register bufferp bu, bu2;
  833    1   	
  834    1   	  pacurrent = se_current_page;
                  04 AE 00000000 EF D0    0B3A		movl	SE_CURRENT_PAGE,4(sp)

  835    1   	  pa_switch(-1);
                           7E FF 8F 98    0B42		cvtbl	#-1,-(sp)
                    00000000* EF 01 FB    0B46		calls	#1,PA_SWITCH

  836    1   	  q_switch_to_buffer(null, "Buffer list");
                              6D A7 DF    0B4D		pushal	109(r7)
                                 00 DD    0B50		pushl	#0
                    00000000* EF 02 FB    0B52		calls	#2,Q_SWITCH_TO_BUFFER

  837    1   	  delete_other_windows();
                    00000000* EF 00 FB    0B59		calls	#0,DELETE_OTHER_WINDOWS

  838    1   	  pa_update;
                  52 00000000 EF 02 78    0B60		ashl	#2,SE_CURRENT_PAGE,r2
                              52 03 C0    0B68		addl2	#3,r2
                     62 00000000 EF D0    0B6B		movl	SE_CURRENT_WINDOW,(r2)

  839    1   	  bu_clear_text(se_current_buffer);
                              00 B2 DD    0B72		pushl	@0(r2)
                    00000000* EF 01 FB    0B75		calls	#1,BU_CLEAR_TEXT

  840    1   	  mp_set_mappings(se_current_buffer, TEXT);
                                 04 DD    0B7C		pushl	#4
                     52 00000000 EF D0    0B7E		movl	SE_CURRENT_WINDOW,r2
                                 62 DD    0B85		pushl	(r2)
                    00000000* EF 02 FB    0B87		calls	#2,MP_SET_MAPPINGS

  841    1   	  insert_string(head);
                            F46E CF DF    0B8E		pushal	$CODE
                    00000000* EF 01 FB    0B92		calls	#1,INSERT_STRING

  842    1   	  do_files = true;
                              6E 01 D0    0B99		movl	#1,(sp)

  843    1   	  do {
                    58 00000000* EF 9E    0B9C		movab	INSERT_STRING,r8
                 08 AE 00000000* EF 9E    0BA3		movab	HO_LENGTH,8(sp)
                 0C AE 00000000* EF 9E    0BAB		movab	HO_ITOC,12(sp)
                    5A 00000000* EF 9E    0BB3		movab	INSERT_CHARACTER,r10
                    59 00000000* EF 9E    0BBA		movab	TAB_TO_COLUMN,r9
                 10 AE 00000000* EF 9E    0BC1		movab	BU_LIST_PAGE,16(sp)
           00000014 EE 00000000* EF 9E    0BC9		movab	ST_LENGTH,20(sp)
                                          0BD4	sym.83:

  844    2   	    bu_map(se_buffers,bu) {
                     54 00000000 EF D0    0BD4		movl	SE_BUFFERS,r4
                                 03 12    0BDB		bneq	gen.9
                               0180 31    0BDD		brw	sym.100
                                          0BE0	gen.9:
                                          0BE0	sym.84:

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 30
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  845    3   	      if (do_files ^ (bu_file_name(bu) == null)) { /* do files, then buffers */
                              55 64 D0    0BE0		movl	(r4),r5
                           52 55 02 78    0BE3		ashl	#2,r5,r2
                              52 03 C0    0BE7		addl2	#3,r2
                                 53 D4    0BEA		clrl	r3
                                 62 D5    0BEC		tstl	(r2)
                                 02 12    0BEE		bneq	vcg.1
                                 53 D6    0BF0		incl	r3
                                          0BF2	vcg.1:
                              53 6E CC    0BF2		xorl2	(sp),r3
                                 03 12    0BF5		bneq	gen.10
                               0158 31    0BF7		brw	sym.99
                                          0BFA	gen.10:

  846    4   		bu_map_sub_buffers(bu,bu2) {
                              53 55 D0    0BFA		movl	r5,r3
                                 03 12    0BFD		bneq	gen.11
                               0150 31    0BFF		brw	sym.99
                                          0C02	gen.11:
                                 50 D5    0C02		tstl	r0
                                          0C04	sym.85:

  847    5   		  if (bu2 == bu_parent(bu)) {
                              64 53 D1    0C04		cmpl	r3,(r4)
                                 6B 12    0C07		bneq	sym.88

  848    6   		    if (bu_parent(bu2) != bu_parent(se_current_buffer) &&
  849    6   			  mod(bu_modified(bu2),2) == 1)
                              52 63 D0    0C09		movl	(r3),r2
                     50 00000000 EF D0    0C0C		movl	SE_CURRENT_WINDOW,r0
                           00 B0 52 D1    0C13		cmpl	r2,@0(r0)
                                 23 13    0C17		beql	sym.86
                           52 52 02 78    0C19		ashl	#2,r2,r2
                              52 04 C0    0C1D		addl2	#4,r2
                        50 62 00 00 7A    0C20		emul	#0,#0,(r2),r0
                        50 51 50 02 7B    0C25		ediv	#2,r0,r1,r0
                              52 50 D0    0C2A		movl	r0,r2
                              01 52 D1    0C2D		cmpl	r2,#1
                                 0A 12    0C30		bneq	sym.86

  850    6   		      insert_string("M ");
                              79 A7 DF    0C32		pushal	121(r7)
                              68 01 FB    0C35		calls	#1,(r8)

  851    6   		    else
                                 08 11    0C38		brb	sym.87
                                 50 D5    0C3A		tstl	r0
                                          0C3C	sym.86:

  852    6   		      insert_string("  ");
                              7C A7 DF    0C3C		pushal	124(r7)
                              68 01 FB    0C3F		calls	#1,(r8)
                                          0C42	sym.87:

  853    6   		    curcol = 3;
                              56 03 D0    0C42		movl	#3,r6


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 31
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  854    6   		    if (bu_name(bu2) != null) {
                              52 63 D0    0C45		movl	(r3),r2
                           50 52 02 78    0C48		ashl	#2,r2,r0
                              50 02 C0    0C4C		addl2	#2,r0
                                 60 D5    0C4F		tstl	(r0)
                                 24 13    0C51		beql	sym.89

  855    7   		      insert_string(st_buffer(bu_name(bu2)));
                              52 6B DE    0C53		moval	(r11),r2
                           7E 52 60 C1    0C56		addl3	(r0),r2,-(sp)
                              68 01 FB    0C5A		calls	#1,(r8)

  856    7   		      curcol = curcol + ho_length(st_buffer(bu_name(bu2)));
                              50 6B DE    0C5D		moval	(r11),r0
                           52 63 02 78    0C60		ashl	#2,(r3),r2
                              52 02 C0    0C64		addl2	#2,r2
                           7E 50 62 C1    0C67		addl3	(r2),r0,-(sp)
                           0C BE 01 FB    0C6B		calls	#1,@12(sp)
                              56 50 C0    0C6F		addl2	r0,r6

  857    7   		      }
  858    6   		    }
  859    5   		  else
                                 03 11    0C72		brb	sym.89
                                          0C74	sym.88:

  860    5   		    curcol = 1;
                              56 01 D0    0C74		movl	#1,r6
                                          0C77	sym.89:

  861    5   		  if (bu2 == se_current_buffer || bu_modified(bu2) == 2) {
                     52 00000000 EF D0    0C77		movl	SE_CURRENT_WINDOW,r2
                              62 53 D1    0C7E		cmpl	r3,(r2)
                                 0C 13    0C81		beql	sym.90
                           52 63 02 78    0C83		ashl	#2,(r3),r2
                              52 04 C0    0C87		addl2	#4,r2
                              02 62 D1    0C8A		cmpl	(r2),#2
                                 09 12    0C8D		bneq	sym.91
                                          0C8F	sym.90:

  862    6   		    nlen = 0;
                                 55 D4    0C8F		clrl	r5

  863    6   		    num[0] = EOS;
                              F3 AD 94    0C91		clrb	-13(fp)

  864    6   		    }
  865    5   		  else
                                 17 11    0C94		brb	sym.92
                                 50 D5    0C96		tstl	r0
                                          0C98	sym.91:

  866    5   		    nlen = ho_itoc(bu_size(bu2),num,9);
                                 09 DD    0C98		pushl	#9
                              F3 AD DF    0C9A		pushal	-13(fp)
                           52 53 02 78    0C9D		ashl	#2,r3,r2
                              52 0B C0    0CA1		addl2	#11,r2

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 32
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                                 62 DD    0CA4		pushl	(r2)
                           18 BE 03 FB    0CA6		calls	#3,@24(sp)
                              55 50 D0    0CAA		movl	r0,r5
                                          0CAD	sym.92:

  867    5   		  if (curcol + 1 + nlen > 29)
                           52 56 01 C1    0CAD		addl3	#1,r6,r2
                              52 55 C0    0CB1		addl2	r5,r2
                              1D 52 D1    0CB4		cmpl	r2,#29
                                 05 15    0CB7		bleq	sym.93

  868    5   		    insert_character(NEWLINE);
                                 0A DD    0CB9		pushl	#10
                              6A 01 FB    0CBB		calls	#1,(r10)

  869    5   		  tab_to_column(29 - nlen);
                                          0CBE	sym.93:
                           7E 1D 55 C3    0CBE		subl3	r5,#29,-(sp)
                              69 01 FB    0CC2		calls	#1,(r9)

  870    5   		  insert_string(num);
                              F3 AD DF    0CC5		pushal	-13(fp)
                              68 01 FB    0CC8		calls	#1,(r8)

  871    5   		  if (bu2 == bu_parent(bu)) {
                              64 53 D1    0CCB		cmpl	r3,(r4)
                                 6E 12    0CCE		bneq	sym.98

  872    6   		    bu_list_page(bu2,pacurrent);
                              04 AE DD    0CD0		pushl	4(sp)
                                 53 DD    0CD3		pushl	r3
                           18 BE 02 FB    0CD5		calls	#2,@24(sp)

  873    6   		    if (bu_file_name(bu2) != null) {
                           52 63 02 78    0CD9		ashl	#2,(r3),r2
                              52 03 C0    0CDD		addl2	#3,r2
                                 62 D5    0CE0		tstl	(r2)
                                 5A 13    0CE2		beql	sym.98

  874    7   		      flen = st_length(bu_file_name(bu2));
                                 62 DD    0CE4		pushl	(r2)
                           18 BE 01 FB    0CE6		calls	#1,@24(sp)
                              55 50 D0    0CEA		movl	r0,r5

  875    7   		      if (41 + flen > sc_width) {
                           52 55 29 C1    0CED		addl3	#41,r5,r2
                     00000000 EF 52 D1    0CF1		cmpl	r2,SC_WIDTH
                                 2E 15    0CF8		bleq	sym.96

  876    8   			insert_character(NEWLINE);
                                 0A DD    0CFA		pushl	#10
                              6A 01 FB    0CFC		calls	#1,(r10)

  877    8   			tab_to_column(max(5, ((int)(sc_width - flen - 1)/8)*8 + 1));
                  52 00000000 EF 55 C3    0CFF		subl3	r5,SC_WIDTH,r2
                                 52 D7    0D07		decl	r2
                              52 08 C6    0D09		divl2	#8,r2

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 33
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                           52 52 03 78    0D0C		ashl	#3,r2,r2
                                 52 D6    0D10		incl	r2
                              52 05 D1    0D12		cmpl	#5,r2
                                 05 15    0D15		bleq	sym.94
                              55 05 D0    0D17		movl	#5,r5
                                 03 11    0D1A		brb	sym.95
                                          0D1C	sym.94:
                              55 52 D0    0D1C		movl	r2,r5
                                          0D1F	sym.95:
                                 55 DD    0D1F		pushl	r5
                              69 01 FB    0D21		calls	#1,(r9)

  878    8   			}
  879    7   		      else
                                 07 11    0D24		brb	sym.97
                                 50 D5    0D26		tstl	r0
                                          0D28	sym.96:

  880    7   			tab_to_column(41);
                                 29 DD    0D28		pushl	#41
                              69 01 FB    0D2A		calls	#1,(r9)
                                          0D2D	sym.97:

  881    7   		      insert_string(st_buffer(bu_file_name(bu2)));
                              50 6B DE    0D2D		moval	(r11),r0
                           52 63 02 78    0D30		ashl	#2,(r3),r2
                              52 03 C0    0D34		addl2	#3,r2
                           7E 50 62 C1    0D37		addl3	(r2),r0,-(sp)
                              68 01 FB    0D3B		calls	#1,(r8)

  882    7   		      }
  883    6   		    }
                                          0D3E	sym.98:

  884    5   		  insert_character(NEWLINE);
                                 0A DD    0D3E		pushl	#10
                              6A 01 FB    0D40		calls	#1,(r10)

  885    5   		  }
                           52 53 02 78    0D43		ashl	#2,r3,r2
                              52 18 C0    0D47		addl2	#24,r2
                              53 62 D0    0D4A		movl	(r2),r3
                                 03 13    0D4D		beql	gen.12
                               FEB2 31    0D4F		brw	sym.85
                                          0D52	gen.12:
                                          0D52	sym.99:

  886    4   		}
  887    3   	      }
                           52 64 02 78    0D52		ashl	#2,(r4),r2
                                 52 D6    0D56		incl	r2
                              54 62 D0    0D58		movl	(r2),r4
                                 03 13    0D5B		beql	gen.13
                               FE80 31    0D5D		brw	sym.84
                                          0D60	gen.13:
                                          0D60	sym.100:


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 34
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  888    2   	    do_files = ! do_files;
                                 52 D4    0D60		clrl	r2
                                 6E D5    0D62		tstl	(sp)
                                 02 12    0D64		bneq	vcg.2
                                 52 D6    0D66		incl	r2
                                          0D68	vcg.2:
                              6E 52 D0    0D68		movl	r2,(sp)

  889    2   	    } while (! do_files);			/* do files, then buffers */
                                 03 12    0D6B		bneq	gen.14
                               FE64 31    0D6D		brw	sym.83
                                          0D70	gen.14:

  890    1   	  wi_dot(se_current_window) = 1;
                  52 00000000 EF 02 78    0D70		ashl	#2,SE_CURRENT_WINDOW,r2
                                 52 D6    0D78		incl	r2
                              62 01 D0    0D7A		movl	#1,(r2)

  891    1   	  bu_modified(se_current_buffer) = 0;
                     52 00000000 EF D0    0D7D		movl	SE_CURRENT_WINDOW,r2
                        52 00 B2 02 78    0D84		ashl	#2,@0(r2),r2
                              52 04 C0    0D89		addl2	#4,r2
                                 62 D4    0D8C		clrl	(r2)

  892    1   	  ms_message("Type carriage-return to exit Buffer list.");
                              7F A7 DF    0D8E		pushal	127(r7)
                    00000000* EF 01 FB    0D91		calls	#1,MS_MESSAGE

  893    1   	  return true;
                              50 01 D0    0D98		movl	#1,r0
                                    04    0D9B		ret	

  894    1   	}
  895        	
  896        	void bu_list_page(register bufferp bu, pagep pacurrent)
  897        	{
                                          0D9C	bu_list_page:
                                    000C  0D9C		.entry	bu_list_page,^m<r2,r3>
                              5E 10 C2    0D9E		subl2	#16,sp
                           50 04 AC D0    0DA1		movl	4(ap),r0

  898    1   	  register pagep pa;
  899    1   	  register windowp wi;
  900    1   	  char num[9];
  901    1   	
  902    1   	  pa = pacurrent;
                           52 08 AC D0    0DA5		movl	8(ap),r2

  903    1   	  wi_map(pa_windows(pa),wi)
                           51 52 02 78    0DA9		ashl	#2,r2,r1
                              51 02 C0    0DAD		addl2	#2,r1
                              53 61 D0    0DB0		movl	(r1),r3
                                 15 13    0DB3		beql	sym.102
                                 50 D5    0DB5		tstl	r0
                                    01    0DB7		nop	
                                          0DB8	sym.101:


BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 35
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

  904    1   	    if (wi_parent_buffer(wi) == bu_parent(bu))
                           60 00 B3 D1    0DB8		cmpl	@0(r3),(r0)
                                 42 13    0DBC		beql	L10

  905    1   	      goto L10;
  906    1   	  pa_map(se_pages, pa)
                           51 53 02 78    0DBE		ashl	#2,r3,r1
                              51 09 C0    0DC2		addl2	#9,r1
                              53 61 D0    0DC5		movl	(r1),r3
                                 EE 12    0DC8		bneq	sym.101
                                          0DCA	sym.102:
                     52 00000000 EF D0    0DCA		movl	SE_PAGES,r2
                                 2C 13    0DD1		beql	sym.106
                                    01    0DD3		nop	
                                          0DD4	sym.103:

  907    1   	    if (pa != pacurrent)
                           08 AC 52 D1    0DD4		cmpl	r2,8(ap)
                                 20 13    0DD8		beql	sym.105

  908    1   	      wi_map(pa_windows(pa), wi)
                           51 52 02 78    0DDA		ashl	#2,r2,r1
                              51 02 C0    0DDE		addl2	#2,r1
                              53 61 D0    0DE1		movl	(r1),r3
                                 14 13    0DE4		beql	sym.105
                                 50 D5    0DE6		tstl	r0
                                          0DE8	sym.104:

  909    1   		if (wi_parent_buffer(wi) == bu_parent(bu))
                           60 00 B3 D1    0DE8		cmpl	@0(r3),(r0)
                                 12 13    0DEC		beql	L10

  910    1   		  goto L10;
  911    1   	  return;
                           51 53 02 78    0DEE		ashl	#2,r3,r1
                              51 09 C0    0DF2		addl2	#9,r1
                              53 61 D0    0DF5		movl	(r1),r3
                                 EE 12    0DF8		bneq	sym.104
                                          0DFA	sym.105:
                              52 62 D0    0DFA		movl	(r2),r2
                                 D5 12    0DFD		bneq	sym.103
                                          0DFF	sym.106:
                                    04    0DFF		ret	

  912    1   	L10:
                                          0E00	L10:

  913    1   	  ho_itocrj(pa_number(pa),num,9);
                                 09 DD    0E00		pushl	#9
                              F3 AD DF    0E02		pushal	-13(fp)
                           50 52 02 78    0E05		ashl	#2,r2,r0
                                 50 D6    0E09		incl	r0
                                 60 DD    0E0B		pushl	(r0)
                    00000000* EF 03 FB    0E0D		calls	#3,HO_ITOCRJ

  914    1   	  insert_string(num);
                              F3 AD DF    0E14		pushal	-13(fp)

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 36
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

                    00000000* EF 01 FB    0E17		calls	#1,INSERT_STRING

  915    1   	  if (wi == pa_current_window(pacurrent))
                        52 08 AC 02 78    0E1E		ashl	#2,8(ap),r2
                              52 03 C0    0E23		addl2	#3,r2
                              62 53 D1    0E26		cmpl	r3,(r2)
                                 09 12    0E29		bneq	sym.107

  916    1   	    insert_character('*');
                                 2A DD    0E2B		pushl	#42
                    00000000* EF 01 FB    0E2D		calls	#1,INSERT_CHARACTER

  917    1   	}
                                          0E34	sym.107:
                                    04    0E34		ret	

  918        	
  919        	void bu_switch_case(void)
  920        	{
                                          0E35	bu_switch_case:
                                    0004  0E35		.entry	bu_switch_case,^m<r2>
                              5E 04 C2    0E37		subl2	#4,sp
                     52 00000000 EF 9E    0E3A		movab	$CHAR_STRING_CONSTANTS,r2

  921    1   	  bu_case(se_current_buffer) = 1 - bu_case(se_current_buffer);
                     50 00000000 EF D0    0E41		movl	SE_CURRENT_WINDOW,r0
                        50 00 B0 02 78    0E48		ashl	#2,@0(r0),r0
                              50 09 C0    0E4D		addl2	#9,r0
                           60 01 60 C3    0E50		subl3	(r0),#1,(r0)

  922    1   	  if (bu_case(se_current_buffer) == 1)
                     50 00000000 EF D0    0E54		movl	SE_CURRENT_WINDOW,r0
                        50 00 B0 02 78    0E5B		ashl	#2,@0(r0),r0
                              50 09 C0    0E60		addl2	#9,r0
                              01 60 D1    0E63		cmpl	(r0),#1
                                 0C 12    0E66		bneq	sym.108

  923    1   	    ms_message("Buffer is now in upper case mode.");
                            00A9 C2 DF    0E68		pushal	169(r2)
                    00000000* EF 01 FB    0E6C		calls	#1,MS_MESSAGE

  924    1   	  else
                                    04    0E73		ret	
                                          0E74	sym.108:

  925    1   	    ms_message("Buffer is now in lower/upper case mode.");
                            00CB C2 DF    0E74		pushal	203(r2)
                    00000000* EF 01 FB    0E78		calls	#1,MS_MESSAGE

  926    1   	}
                                    04    0E7F		ret	

 
 
Command Line
------------
 

BUFFER                                                          12-NOV-1987 16:11:51    VAX C      V2.3-024                 Page 37
V1.0                                                            12-NOV-1987 14:03:38    COM$8:[WOOD.WINDOW.WOOD.C]BUFFER.C;28 (1)

CC/MACH/LIS BUFFER

